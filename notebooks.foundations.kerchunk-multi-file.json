{"version":2,"kind":"Notebook","sha256":"701b929d406092b26b4ca3623dbf34b5b751bfa46fd8be85eb54aa9e00735184","slug":"notebooks.foundations.kerchunk-multi-file","location":"/notebooks/foundations/02_kerchunk_multi_file.ipynb","dependencies":[],"frontmatter":{"title":"Multi-file virtual datasets with VirtualiZarr","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"kerchunk-cookbook","language":"python"},"authors":[{"nameParsed":{"literal":"Norland Raphael Hagen","given":"Norland Raphael","family":"Hagen"},"name":"Norland Raphael Hagen","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/kerchunk-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/kerchunk-cookbook/blob/main/notebooks/foundations/02_kerchunk_multi_file.ipynb","thumbnail":"/kerchunk-cookbook/build/thumbnail-c509e5d5458a69ce2b6321d13e31d5cf.png","exports":[{"format":"ipynb","filename":"02_kerchunk_multi_file.ipynb","url":"/kerchunk-cookbook/build/02_kerchunk_multi_fi-aab9d8d2ed71436d70a2024326b07db2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","url":"/kerchunk-cookbook/build/thumbnail-c509e5d5458a69ce2b6321d13e31d5cf.png","alt":"Kerchunk Logo","width":500,"key":"M0meP7UnKh","urlSource":"../../thumbnail.png"}],"key":"VwZ0GQdumC"}],"key":"b8sDdgRg5s"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Multi-file virtual datasets with VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D0gScN2KbU"}],"identifier":"multi-file-virtual-datasets-with-virtualizarr","label":"Multi-file virtual datasets with VirtualiZarr","html_id":"multi-file-virtual-datasets-with-virtualizarr","implicit":true,"key":"gmFdwC10nt"}],"key":"rzm9stdMwy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HGL4CtiiwI"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"fwIvWfdp4u"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook is intends to build off of the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Fi5Y5lTuIa"},{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Di25DeIkg9"}],"urlSource":"./01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"nfr03ibVuw"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tlQokmdhVI"}],"key":"SkD8RWloOZ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In this tutorial we will:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"g2fo6m9Gtp"}],"key":"YgxdGMHlSZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Create a list of input paths for a collection of NetCDF files stored on the cloud.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"VX4CQiht8w"}],"key":"K0NrUrNuDY"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Create virtual datasets for each input datasets","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"H8PcABUlvj"}],"key":"jIZgZRuZMF"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Combine the virtual datasets using combine_nested","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"AxlGIgbqfH"}],"key":"puiHqDes8P"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Read the combined dataset using ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Wl9Sw8hRTT"},{"type":"link","url":"https://docs.xarray.dev/en/stable/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"Xarray","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GksFrMT7sg"}],"urlSource":"https://docs.xarray.dev/en/stable/","key":"s1h57jHkS2"},{"type":"text","value":" and ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gLKysWLw72"},{"type":"link","url":"https://filesystem-spec.readthedocs.io/en/latest/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"fsspec","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ZprJYkzwSM"}],"urlSource":"https://filesystem-spec.readthedocs.io/en/latest/","key":"YplNb1qmSg"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"iArGB1sL5t"}],"key":"u8QFAdtY61"}],"key":"Hft1BtDJIU"}],"key":"ndYRtQ2MX7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L8LHJ7DMQj"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"LBvCpCxKtT"},{"type":"table","position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jqzdKM8UZv"}],"key":"LB4JC4evzT"},{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rfS5HJPKC4"}],"key":"wJHZc2GQ5j"},{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mtw6hoS1gM"}],"key":"oYrRBeV0Aa"}],"key":"JfL01QjUS2"},{"type":"tableRow","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vANPTj1dJH"}],"urlSource":"./01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"A7qkhPxR09"}],"key":"yNzXtPqLzT"},{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"c0m9I9LBET"}],"key":"fmWUBmvrWb"},{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Basic features","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aZUEnUBGbo"}],"key":"NPdhE70YHv"}],"key":"xtVvZ9KmqW"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Introduction to Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rOwPbhM0AM"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"CRpDYN1O39"}],"key":"M3MeutKhUc"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Recommended","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"S6Agp8Olki"}],"key":"yzmXVATjPk"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"IO","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YpQeW30xCW"}],"key":"CHlRmhdQDD"}],"key":"nuI57L2tdo"}],"key":"vOIIaHLrL9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Oy2SUhLQYj"}],"key":"bXXPq8fPUk"},{"type":"text","value":": 60 minutes","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IzoedJoy8x"}],"key":"nNhlpMByrx"}],"key":"iIgywTHlIQ"},{"type":"thematicBreak","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"zFmYxE4ZwF"}],"key":"rBb2bZrJLu"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Flags","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fzOgM82TRW"}],"identifier":"flags","label":"Flags","html_id":"flags","implicit":true,"key":"RQEW9pURfI"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In the section below, set the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Bjh5mhJBbU"},{"type":"inlineCode","value":"subset","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"XKsIQmyegx"},{"type":"text","value":" flag to be ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lb5h9oEume"},{"type":"inlineCode","value":"True","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uFMfriECHw"},{"type":"text","value":" (default) or ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kMpt0e5cBk"},{"type":"inlineCode","value":"False","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"necJNAq6vK"},{"type":"text","value":" depending if you want this notebook to process the full file list. If set to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"X9kVqauUB8"},{"type":"inlineCode","value":"True","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MQ7yiRrw39"},{"type":"text","value":", then a subset of the file list will be processed (Recommended)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"aJA4qOJXwd"}],"key":"Exy10eHQBN"}],"key":"TLxk9TNy6l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subset_flag = True","key":"KoBkHFgDeY"},{"type":"output","id":"fT8clDeOaxcOe25-_FPf-","data":[],"key":"QNMMY1xlel"}],"key":"eua3RYMX7H"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pHuPK9dmk6"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"kCDhIThJrG"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In our imports block we are using similar imports to the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"x1FeTBet6j"},{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores tutorial","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cH0a1ZQQcb"}],"urlSource":"./01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"YBYVBVtwiR"},{"type":"text","value":":","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"p4O6yrWsHm"}],"key":"O99Q9OqNS0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"fsspec","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dd8rTMELOI"},{"type":"text","value":" for reading and writing to remote file systems","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oRM5WIi5Od"}],"key":"dZKaDc1sOg"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"inlineCode","value":"virtualizarr","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RYFh9i7DId"},{"type":"text","value":" will be used to generate the virtual Zarr store","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aMZJbBsY87"}],"key":"Qb2ooGR8WK"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"inlineCode","value":"Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NPWijhqZlI"},{"type":"text","value":" for examining the output dataset","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nFX1kuow8L"}],"key":"RrRwM8QZ2J"}],"key":"AJ0bjlnSoJ"}],"key":"p6bnxOMspS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import fsspec\nimport xarray as xr\nfrom virtualizarr import open_virtual_dataset","key":"u0FSTnbbIa"},{"type":"output","id":"BUtiICdgADySolcmLS_fZ","data":[],"key":"V7zX3L2pz7"}],"key":"J1Y99EBl8V"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a File Pattern from a list of  input NetCDF files","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"un3dIh4p4E"}],"identifier":"create-a-file-pattern-from-a-list-of-input-netcdf-files","label":"Create a File Pattern from a list of  input NetCDF files","html_id":"create-a-file-pattern-from-a-list-of-input-netcdf-files","implicit":true,"key":"m1Oc9I289g"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Below we will create a list of input files we want to virtualize. In the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ShenJOLuz7"},{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fZfBtILVvS"}],"urlSource":"./01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"wPHhSa9O1C"},{"type":"text","value":", we looked at a single file of climate downscaled data over Southern Alaska. In this example, we will build off of that work and use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TtJFPihyQU"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cBdERKjyqi"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qEPSJHLTRt"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WrRtbtNadO"},{"type":"text","value":" to combine multiple NetCDF files of this dataset into a virtual dataset that can be read as if it were a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QcPzU6Hcyu"},{"type":"inlineCode","value":"Zarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MvJGTVS2Bn"},{"type":"text","value":" store - without copying any data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tXYjfctzfm"}],"key":"BD0M2r1IZB"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bWuyR2DnBu"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jwDAzsMPQt"},{"type":"text","value":" ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zZnVEGrRMD"},{"type":"inlineCode","value":"s3","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ccF7CBYeq5"},{"type":"text","value":" filesystem’s ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tRTg2U8ljz"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"glob","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SZktXQX896"}],"key":"dJP3Gz0qFs"},{"type":"text","value":" method to create a list of files matching a file pattern. We supply the base url of ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IsOnSPOzKZ"},{"type":"inlineCode","value":"s3://wrf-se-ak-ar5/ccsm/rcp85/daily/2060/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ixh66C55uz"},{"type":"text","value":", which is pointing to an ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qPmoUeH40f"},{"type":"inlineCode","value":"AWS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oekv2YHuzj"},{"type":"text","value":" public bucket, for daily rcp85 ccsm downscaled data for the year 2060. After this base url, we tacked on ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LmfpdTPH4f"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"*","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"OClJJ3Mdpd"}],"key":"F7KZliNH18"},{"type":"text","value":", which acts as a wildcard for all the files in the directory. We should expect 365 daily ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TEEwAhP6bR"},{"type":"inlineCode","value":"NetCDF","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LSG5JYS3xL"},{"type":"text","value":" files.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MBTs19fy1R"}],"key":"aSGWFefOpC"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Finally, we are appending the string ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jj0KCchT58"},{"type":"inlineCode","value":"s3://","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OztZTJk42T"},{"type":"text","value":" to the list of return files. This will ensure the list of files we get back are ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"A2AvRxEFV9"},{"type":"inlineCode","value":"s3","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BJlIibXtqZ"},{"type":"text","value":" urls and can be read by ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"XzVBgtScHB"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"LA991ANlkx"},{"type":"text","value":" and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FZD7UoRwVi"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mgZY7rThhR"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BFcYeIBdjr"}],"key":"ocH2vJ3byQ"}],"key":"lyO6Ixcxvs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initiate fsspec filesystems for reading and writing\nfs_read = fsspec.filesystem(\"s3\", anon=True, skip_instance_cache=True)\n\n# Retrieve list of available days in archive for the year 2060.\nfiles_paths = fs_read.glob(\"s3://wrf-se-ak-ar5/ccsm/rcp85/daily/2060/*\")\n\n# Here we prepend the prefix 's3://', which points to AWS.\nfiles_paths = sorted([\"s3://\" + f for f in files_paths])","key":"zuRLW2q7bI"},{"type":"output","id":"bLs5Wq2rrl7DuIy2KQGSA","data":[],"key":"DS2nNwqIMd"}],"key":"SNBE4A856M"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As a quick check, it looks like we have a list 365 file paths, which should be a year of downscaled climte data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rY3DQdaMbt"}],"identifier":"as-a-quick-check-it-looks-like-we-have-a-list-365-file-paths-which-should-be-a-year-of-downscaled-climte-data","label":"As a quick check, it looks like we have a list 365 file paths, which should be a year of downscaled climte data.","html_id":"as-a-quick-check-it-looks-like-we-have-a-list-365-file-paths-which-should-be-a-year-of-downscaled-climte-data","implicit":true,"key":"eaF4rCWmYV"}],"key":"D2I8AYgaan"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"{len(files_paths)} file paths were retrieved.\")","key":"uMjhcLwQn8"},{"type":"output","id":"6544r2mFtSGd9GsYbshdn","data":[{"output_type":"stream","name":"stdout","text":"365 file paths were retrieved.\n"}],"key":"y9ArZS6lJm"}],"key":"ua02HPC40C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# If the subset_flag == True (default), the list of input files will\n# be subset to speed up the processing\nif subset_flag:\n    files_paths = files_paths[0:4]","key":"eEu8RHXr7c"},{"type":"output","id":"vW95O88q37nPBhumIwHK2","data":[],"key":"KFTkilcovN"}],"key":"Iom8NQQOni"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optional: If you want to examine one NetCDF files before creating the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mFvbGsKnEO"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l5IdX7JN1N"},{"type":"text","value":" index, try uncommenting this code snippet below.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gdq57UFDt7"}],"identifier":"optional-if-you-want-to-examine-one-netcdf-files-before-creating-the-kerchunk-index-try-uncommenting-this-code-snippet-below","label":"Optional: If you want to examine one NetCDF files before creating the Kerchunk index, try uncommenting this code snippet below.","html_id":"optional-if-you-want-to-examine-one-netcdf-files-before-creating-the-kerchunk-index-try-uncommenting-this-code-snippet-below","implicit":true,"key":"T8KDM0xYTj"}],"key":"gpJDmVjRSz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Note: Optional piece of code to view one of the NetCDFs\n\n# import s3fs\n\n# fs = fsspec.filesystem(\"s3\",anon=True)\n# ds = xr.open_dataset(fs.open(file_pattern[0]))","key":"dqocX39cf4"},{"type":"output","id":"APSoeJH4aLZW63xxb7_vv","data":[],"key":"XdeKJujYIC"}],"key":"NBNWy8Sfen"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create virtual datasets for every file in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EQQM56BGkc"},{"type":"inlineCode","value":"File_Pattern","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xmatdeawQC"},{"type":"text","value":" list","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rqzmIrvn8r"}],"identifier":"create-virtual-datasets-for-every-file-in-the-file-pattern-list","label":"Create virtual datasets for every file in the File_Pattern list","html_id":"create-virtual-datasets-for-every-file-in-the-file-pattern-list","implicit":true,"key":"Tlznv7VwWf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now that we have a list of NetCDF files, we can use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vowk4PBgV4"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gpx2m4m0EY"},{"type":"text","value":" to create virtual datasets for each one of these.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mLou7PKfGt"}],"key":"ucj93aAlli"}],"key":"EoCCzNmtza"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define kwargs for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qLFuCJ3TuM"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L4BjpW8K2b"}],"identifier":"define-kwargs-for-fsspec","label":"Define kwargs for fsspec","html_id":"define-kwargs-for-fsspec","implicit":true,"key":"j04U07Qu3B"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In the cell below, we are creating a dictionary of ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UYujE2i8vp"},{"type":"inlineCode","value":"kwargs","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TfZvrjoghN"},{"type":"text","value":" to pass to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PZSlDG2IVx"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Eh389Gswg1"},{"type":"text","value":" and the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"R1gmiENhyQ"},{"type":"inlineCode","value":"s3","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"s88aVpE4pE"},{"type":"text","value":" filesystem. Details on this can be found in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ptTYoIb5sK"},{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores tutorial","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jLivYPE33z"}],"urlSource":"./01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"VaUiiEOjSi"},{"type":"text","value":" in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YhQRpiImdQ"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Define storage_options arguments","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UYm8wsDHT6"}],"key":"o0xiV68Gl8"},{"type":"text","value":" section","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yqj9CNmMG2"}],"key":"x7SbLQhwjx"}],"key":"wXvTwHZI4v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"storage_options = dict(anon=True, default_fill_cache=False, default_cache_type=\"none\")","key":"ZCs6hOoLba"},{"type":"output","id":"TpsXQAoyflSpsTdHClL9I","data":[],"key":"FJGkDdAMk9"}],"key":"W3Ymkh3OoB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the cell below, we are reusing some of the functionality from the previous tutorial.\nFirst we are defining a function named: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wkUiPeGxPh"},{"type":"inlineCode","value":"generate_json_reference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mBPQUOtuyI"},{"type":"text","value":".\nThis function:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kUXeYFFTGI"}],"key":"BaCaz9P6j4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Uses an ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ujpTUV8GLt"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vBFPkGKCvT"},{"type":"text","value":" ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CPGu0Z0V39"},{"type":"inlineCode","value":"s3","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LqK6SjO0rH"},{"type":"text","value":" filesystem to read in a ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"bPp8KeJdvG"},{"type":"inlineCode","value":"NetCDF","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"jwrY5hzQB2"},{"type":"text","value":" from a given url.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"w6ZOjJg5Zv"}],"key":"p0M20J58od"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Generates a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bqfjVFjPc8"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TcJGMDWsT2"},{"type":"text","value":" index using the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VJCO60Sy0n"},{"type":"inlineCode","value":"SingleHdf5ToZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DA88HmiVaO"},{"type":"text","value":" ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CNPpJ9qjqA"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"erJ3NOZZCE"},{"type":"text","value":" method.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k9G2vZGVQn"}],"key":"gRWKAEAt0g"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Creates a simplified filename using some string slicing.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"duIsH0dPLt"}],"key":"hAMpXFIpcH"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Uses the local filesystem created with ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"wA8aasm2zg"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oMMeqbWmsp"},{"type":"text","value":" to write the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pKcN7tV4SN"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"L6G5veM190"},{"type":"text","value":" index to a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pTecQ0g09e"},{"type":"inlineCode","value":".json","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CTjvBVbslB"},{"type":"text","value":" reference file.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JFQye9VIP4"}],"key":"N2HO1d0yi4"}],"key":"yzFfb5D8fa"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Below the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jurm5QryLa"},{"type":"inlineCode","value":"generate_json_reference","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Sm5Dff5zqG"},{"type":"text","value":" function we created, we have a simple ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"XVY505EaD3"},{"type":"inlineCode","value":"for","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"xCi27zj2QO"},{"type":"text","value":" loop that iterates through our list of ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"bvfSPpQ4aY"},{"type":"inlineCode","value":"NetCDF","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"WMSdkWhMQA"},{"type":"text","value":" file urls and passes them to our ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vrTUnizZPR"},{"type":"inlineCode","value":"generate_json_reference","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"tNfcoE7lLE"},{"type":"text","value":" function, which appends the name of each ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"wIiXn5bK3K"},{"type":"inlineCode","value":".json","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"nBU8oQfqnR"},{"type":"text","value":" reference file to a list named ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TWUhVWytlf"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"output_files","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gfqBpBbcTT"}],"key":"Izd8LRja4I"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JwHjemqEOV"}],"key":"qQ5Yu7kdsy"}],"key":"gGbrq55f6x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"virtual_datasets = [\n    open_virtual_dataset(\n        filepath, indexes={}, reader_options={\"storage_options\": storage_options}\n    )\n    for filepath in files_paths\n]","key":"GSyNVRX7oL"},{"type":"output","id":"jKdovgu4YS_qBr46ZsXJ2","data":[],"key":"MmmMnzY5sC"}],"key":"fQHXLAXkFi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combine virtual datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z8MUTFCbHS"}],"identifier":"combine-virtual-datasets","label":"Combine virtual datasets","html_id":"combine-virtual-datasets","implicit":true,"key":"UPRhO49h01"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"After we have generated a virtual dataset for each ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"IGS9qHo5ym"},{"type":"inlineCode","value":"NetCDF","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"O2mimdOB2W"},{"type":"text","value":" file, we can combine these into a single virtual dataset using Xarray’s ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ny4raQKbZ1"},{"type":"inlineCode","value":"combine_nested","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wX31JVkYcw"},{"type":"text","value":" function.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EqufiLNZBl"}],"key":"Tv8G37yA4T"}],"key":"mcLDOHkV3C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"combined_vds = xr.combine_nested(\n    virtual_datasets, concat_dim=[\"Time\"], coords=\"minimal\", compat=\"override\"\n)\ncombined_vds","key":"NAWcUBRtkl"},{"type":"output","id":"GVHhYygOIIBNb95_IanX7","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mNotImplementedError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[9]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m combined_vds = \u001b[43mxr\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcombine_nested\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m      2\u001b[39m \u001b[43m    \u001b[49m\u001b[43mvirtual_datasets\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mconcat_dim\u001b[49m\u001b[43m=\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mTime\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m=\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mminimal\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m=\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43moverride\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\n\u001b[32m      3\u001b[39m \u001b[43m)\u001b[49m\n\u001b[32m      4\u001b[39m combined_vds\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/combine.py:588\u001b[39m, in \u001b[36mcombine_nested\u001b[39m\u001b[34m(datasets, concat_dim, compat, data_vars, coords, fill_value, join, combine_attrs)\u001b[39m\n\u001b[32m    585\u001b[39m     concat_dim = [concat_dim]\n\u001b[32m    587\u001b[39m \u001b[38;5;66;03m# The IDs argument tells _nested_combine that datasets aren't yet sorted\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m588\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43m_nested_combine\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    589\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdatasets\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    590\u001b[39m \u001b[43m    \u001b[49m\u001b[43mconcat_dims\u001b[49m\u001b[43m=\u001b[49m\u001b[43mconcat_dim\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    591\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    592\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    593\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    594\u001b[39m \u001b[43m    \u001b[49m\u001b[43mids\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m    595\u001b[39m \u001b[43m    \u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m=\u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    596\u001b[39m \u001b[43m    \u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m=\u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    597\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    598\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/combine.py:367\u001b[39m, in \u001b[36m_nested_combine\u001b[39m\u001b[34m(datasets, concat_dims, compat, data_vars, coords, ids, fill_value, join, combine_attrs)\u001b[39m\n\u001b[32m    364\u001b[39m _check_shape_tile_ids(combined_ids)\n\u001b[32m    366\u001b[39m \u001b[38;5;66;03m# Apply series of concatenate or merge operations along each dimension\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m367\u001b[39m combined = \u001b[43m_combine_nd\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    368\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcombined_ids\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    369\u001b[39m \u001b[43m    \u001b[49m\u001b[43mconcat_dims\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    370\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    371\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    372\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    373\u001b[39m \u001b[43m    \u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m=\u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    374\u001b[39m \u001b[43m    \u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m=\u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    375\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    376\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    377\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m combined\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/combine.py:246\u001b[39m, in \u001b[36m_combine_nd\u001b[39m\u001b[34m(combined_ids, concat_dims, data_vars, coords, compat, fill_value, join, combine_attrs)\u001b[39m\n\u001b[32m    242\u001b[39m \u001b[38;5;66;03m# Each iteration of this loop reduces the length of the tile_ids tuples\u001b[39;00m\n\u001b[32m    243\u001b[39m \u001b[38;5;66;03m# by one. It always combines along the first dimension, removing the first\u001b[39;00m\n\u001b[32m    244\u001b[39m \u001b[38;5;66;03m# element of the tuple\u001b[39;00m\n\u001b[32m    245\u001b[39m \u001b[38;5;28;01mfor\u001b[39;00m concat_dim \u001b[38;5;129;01min\u001b[39;00m concat_dims:\n\u001b[32m--> \u001b[39m\u001b[32m246\u001b[39m     combined_ids = \u001b[43m_combine_all_along_first_dim\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    247\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcombined_ids\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    248\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdim\u001b[49m\u001b[43m=\u001b[49m\u001b[43mconcat_dim\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    249\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    250\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    251\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    252\u001b[39m \u001b[43m        \u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m=\u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    253\u001b[39m \u001b[43m        \u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m=\u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    254\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    255\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    256\u001b[39m (combined_ds,) = combined_ids.values()\n\u001b[32m    257\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m combined_ds\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/combine.py:278\u001b[39m, in \u001b[36m_combine_all_along_first_dim\u001b[39m\u001b[34m(combined_ids, dim, data_vars, coords, compat, fill_value, join, combine_attrs)\u001b[39m\n\u001b[32m    276\u001b[39m     combined_ids = \u001b[38;5;28mdict\u001b[39m(\u001b[38;5;28msorted\u001b[39m(group))\n\u001b[32m    277\u001b[39m     datasets = combined_ids.values()\n\u001b[32m--> \u001b[39m\u001b[32m278\u001b[39m     new_combined_ids[new_id] = \u001b[43m_combine_1d\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    279\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdatasets\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdim\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcombine_attrs\u001b[49m\n\u001b[32m    280\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m new_combined_ids\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/combine.py:301\u001b[39m, in \u001b[36m_combine_1d\u001b[39m\u001b[34m(datasets, concat_dim, compat, data_vars, coords, fill_value, join, combine_attrs)\u001b[39m\n\u001b[32m    299\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m concat_dim \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[32m    300\u001b[39m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m301\u001b[39m         combined = \u001b[43mconcat\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    302\u001b[39m \u001b[43m            \u001b[49m\u001b[43mdatasets\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    303\u001b[39m \u001b[43m            \u001b[49m\u001b[43mdim\u001b[49m\u001b[43m=\u001b[49m\u001b[43mconcat_dim\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    304\u001b[39m \u001b[43m            \u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    305\u001b[39m \u001b[43m            \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    306\u001b[39m \u001b[43m            \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    307\u001b[39m \u001b[43m            \u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m=\u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    308\u001b[39m \u001b[43m            \u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m=\u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    309\u001b[39m \u001b[43m            \u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    310\u001b[39m \u001b[43m        \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    311\u001b[39m     \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m err:\n\u001b[32m    312\u001b[39m         \u001b[38;5;28;01mif\u001b[39;00m \u001b[33m\"\u001b[39m\u001b[33mencountered unexpected variable\u001b[39m\u001b[33m\"\u001b[39m \u001b[38;5;129;01min\u001b[39;00m \u001b[38;5;28mstr\u001b[39m(err):\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/concat.py:277\u001b[39m, in \u001b[36mconcat\u001b[39m\u001b[34m(objs, dim, data_vars, coords, compat, positions, fill_value, join, combine_attrs, create_index_for_new_dim)\u001b[39m\n\u001b[32m    264\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m _dataarray_concat(\n\u001b[32m    265\u001b[39m         objs,\n\u001b[32m    266\u001b[39m         dim=dim,\n\u001b[32m   (...)\u001b[39m\u001b[32m    274\u001b[39m         create_index_for_new_dim=create_index_for_new_dim,\n\u001b[32m    275\u001b[39m     )\n\u001b[32m    276\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(first_obj, Dataset):\n\u001b[32m--> \u001b[39m\u001b[32m277\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43m_dataset_concat\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    278\u001b[39m \u001b[43m        \u001b[49m\u001b[43mobjs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    279\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdim\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdim\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    280\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdata_vars\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcoords\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    282\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcompat\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    283\u001b[39m \u001b[43m        \u001b[49m\u001b[43mpositions\u001b[49m\u001b[43m=\u001b[49m\u001b[43mpositions\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    284\u001b[39m \u001b[43m        \u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m=\u001b[49m\u001b[43mfill_value\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    285\u001b[39m \u001b[43m        \u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m=\u001b[49m\u001b[43mjoin\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    286\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    287\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcreate_index_for_new_dim\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcreate_index_for_new_dim\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    288\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    289\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m    290\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mTypeError\u001b[39;00m(\n\u001b[32m    291\u001b[39m         \u001b[33m\"\u001b[39m\u001b[33mcan only concatenate xarray Dataset and DataArray \u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m    292\u001b[39m         \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mobjects, got \u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mtype\u001b[39m(first_obj)\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m\"\u001b[39m\n\u001b[32m    293\u001b[39m     )\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/concat.py:676\u001b[39m, in \u001b[36m_dataset_concat\u001b[39m\u001b[34m(datasets, dim, data_vars, coords, compat, positions, fill_value, join, combine_attrs, create_index_for_new_dim)\u001b[39m\n\u001b[32m    674\u001b[39m         result_vars[k] = v\n\u001b[32m    675\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m676\u001b[39m     combined_var = \u001b[43mconcat_vars\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    677\u001b[39m \u001b[43m        \u001b[49m\u001b[38;5;28;43mvars\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mdim_name\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mpositions\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcombine_attrs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcombine_attrs\u001b[49m\n\u001b[32m    678\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    679\u001b[39m     \u001b[38;5;66;03m# reindex if variable is not present in all datasets\u001b[39;00m\n\u001b[32m    680\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(variable_index) < concat_index_size:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/core/variable.py:3023\u001b[39m, in \u001b[36mconcat\u001b[39m\u001b[34m(variables, dim, positions, shortcut, combine_attrs)\u001b[39m\n\u001b[32m   2975\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mconcat\u001b[39m(\n\u001b[32m   2976\u001b[39m     variables,\n\u001b[32m   2977\u001b[39m     dim=\u001b[33m\"\u001b[39m\u001b[33mconcat_dim\u001b[39m\u001b[33m\"\u001b[39m,\n\u001b[32m   (...)\u001b[39m\u001b[32m   2980\u001b[39m     combine_attrs=\u001b[33m\"\u001b[39m\u001b[33moverride\u001b[39m\u001b[33m\"\u001b[39m,\n\u001b[32m   2981\u001b[39m ):\n\u001b[32m   2982\u001b[39m \u001b[38;5;250m    \u001b[39m\u001b[33;03m\"\"\"Concatenate variables along a new or existing dimension.\u001b[39;00m\n\u001b[32m   2983\u001b[39m \n\u001b[32m   2984\u001b[39m \u001b[33;03m    Parameters\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m   3021\u001b[39m \u001b[33;03m        along the given dimension.\u001b[39;00m\n\u001b[32m   3022\u001b[39m \u001b[33;03m    \"\"\"\u001b[39;00m\n\u001b[32m-> \u001b[39m\u001b[32m3023\u001b[39m     variables = \u001b[38;5;28;43mlist\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43mvariables\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   3024\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mall\u001b[39m(\u001b[38;5;28misinstance\u001b[39m(v, IndexVariable) \u001b[38;5;28;01mfor\u001b[39;00m v \u001b[38;5;129;01min\u001b[39;00m variables):\n\u001b[32m   3025\u001b[39m         \u001b[38;5;28;01mreturn\u001b[39;00m IndexVariable.concat(variables, dim, positions, shortcut, combine_attrs)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/structure/concat.py:598\u001b[39m, in \u001b[36m_dataset_concat.<locals>.ensure_common_dims\u001b[39m\u001b[34m(vars, concat_dim_lengths)\u001b[39m\n\u001b[32m    596\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m var.dims != common_dims:\n\u001b[32m    597\u001b[39m     common_shape = \u001b[38;5;28mtuple\u001b[39m(dims_sizes.get(d, dim_len) \u001b[38;5;28;01mfor\u001b[39;00m d \u001b[38;5;129;01min\u001b[39;00m common_dims)\n\u001b[32m--> \u001b[39m\u001b[32m598\u001b[39m     var = \u001b[43mvar\u001b[49m\u001b[43m.\u001b[49m\u001b[43mset_dims\u001b[49m\u001b[43m(\u001b[49m\u001b[43mcommon_dims\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcommon_shape\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    599\u001b[39m \u001b[38;5;28;01myield\u001b[39;00m var\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/util/deprecation_helpers.py:143\u001b[39m, in \u001b[36mdeprecate_dims.<locals>.wrapper\u001b[39m\u001b[34m(*args, **kwargs)\u001b[39m\n\u001b[32m    135\u001b[39m     emit_user_level_warning(\n\u001b[32m    136\u001b[39m         \u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mThe `\u001b[39m\u001b[38;5;132;01m{\u001b[39;00mold_name\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m` argument has been renamed to `dim`, and will be removed \u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m    137\u001b[39m         \u001b[33m\"\u001b[39m\u001b[33min the future. This renaming is taking place throughout xarray over the \u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m   (...)\u001b[39m\u001b[32m    140\u001b[39m         \u001b[38;5;167;01mPendingDeprecationWarning\u001b[39;00m,\n\u001b[32m    141\u001b[39m     )\n\u001b[32m    142\u001b[39m     kwargs[\u001b[33m\"\u001b[39m\u001b[33mdim\u001b[39m\u001b[33m\"\u001b[39m] = kwargs.pop(old_name)\n\u001b[32m--> \u001b[39m\u001b[32m143\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mfunc\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/xarray/core/variable.py:1401\u001b[39m, in \u001b[36mVariable.set_dims\u001b[39m\u001b[34m(self, dim, shape)\u001b[39m\n\u001b[32m   1394\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m shape \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m \u001b[38;5;129;01mor\u001b[39;00m \u001b[38;5;28mall\u001b[39m(\n\u001b[32m   1395\u001b[39m     s == \u001b[32m1\u001b[39m \u001b[38;5;28;01mfor\u001b[39;00m s, e \u001b[38;5;129;01min\u001b[39;00m \u001b[38;5;28mzip\u001b[39m(shape, dim, strict=\u001b[38;5;28;01mTrue\u001b[39;00m) \u001b[38;5;28;01mif\u001b[39;00m e \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;129;01min\u001b[39;00m self_dims\n\u001b[32m   1396\u001b[39m ):\n\u001b[32m   1397\u001b[39m     \u001b[38;5;66;03m# \"Trivial\" broadcasting, i.e. simply inserting a new dimension\u001b[39;00m\n\u001b[32m   1398\u001b[39m     \u001b[38;5;66;03m# This is typically easier for duck arrays to implement\u001b[39;00m\n\u001b[32m   1399\u001b[39m     \u001b[38;5;66;03m# than the full \"broadcast_to\" semantics\u001b[39;00m\n\u001b[32m   1400\u001b[39m     indexer = (\u001b[38;5;28;01mNone\u001b[39;00m,) * (\u001b[38;5;28mlen\u001b[39m(expanded_dims) - \u001b[38;5;28mself\u001b[39m.ndim) + (...,)\n\u001b[32m-> \u001b[39m\u001b[32m1401\u001b[39m     expanded_data = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mdata\u001b[49m\u001b[43m[\u001b[49m\u001b[43mindexer\u001b[49m\u001b[43m]\u001b[49m\n\u001b[32m   1402\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:  \u001b[38;5;66;03m# elif shape is not None:\u001b[39;00m\n\u001b[32m   1403\u001b[39m     dims_map = \u001b[38;5;28mdict\u001b[39m(\u001b[38;5;28mzip\u001b[39m(dim, shape, strict=\u001b[38;5;28;01mTrue\u001b[39;00m))\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/virtualizarr/manifests/array.py:226\u001b[39m, in \u001b[36mManifestArray.__getitem__\u001b[39m\u001b[34m(self, key)\u001b[39m\n\u001b[32m    224\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\n\u001b[32m    225\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m226\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mNotImplementedError\u001b[39;00m(\u001b[33mf\u001b[39m\u001b[33m\"\u001b[39m\u001b[33mDoesn\u001b[39m\u001b[33m'\u001b[39m\u001b[33mt support slicing with \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mindexer\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m\"\u001b[39m)\n\n\u001b[31mNotImplementedError\u001b[39m: Doesn't support slicing with (None, slice(None, None, None))","ename":"NotImplementedError","evalue":"Doesn't support slicing with (None, slice(None, None, None))"}],"key":"XoWLxsY60p"}],"key":"TMc3mqCOQK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Write combined virtual dataset to a Kerchunk JSON for future use","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c8Bhct119b"}],"identifier":"write-combined-virtual-dataset-to-a-kerchunk-json-for-future-use","label":"Write combined virtual dataset to a Kerchunk JSON for future use","html_id":"write-combined-virtual-dataset-to-a-kerchunk-json-for-future-use","implicit":true,"key":"ECsbje9nUU"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"If we want to keep the combined reference information in memory as well as write the file to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"h5AhylHief"},{"type":"inlineCode","value":".json","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Zf4Oerlo3N"},{"type":"text","value":", we can run the code snippet below.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FpWMmPTFih"}],"key":"pud683klUC"}],"key":"V03Wwd99ju"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Write kerchunk .json record\noutput_fname = \"combined_kerchunk.json\"\ncombined_vds.virtualize.to_kerchunk(output_fname, format=\"json\")","key":"ivToCFzFj9"},{"type":"output","id":"ffKupVhJ3rgkyxvC8V1P4","data":[],"key":"IYDbSNYNvC"}],"key":"aH3dPfCwV7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using the output","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XIQOPUrHAZ"}],"identifier":"using-the-output","label":"Using the output","html_id":"using-the-output","implicit":true,"key":"YqESWbm45V"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now that we have built a virtual dataset using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KZsHG1Kosr"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qMz9U4Nd22"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Skf9xZFy9S"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LiqfpJE2Tb"},{"type":"text","value":", we can read all of those original ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EZO6vdCtkl"},{"type":"inlineCode","value":"NetCDF","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cANGzVi5L0"},{"type":"text","value":" files as if they were a single ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hGMfiK3WzR"},{"type":"inlineCode","value":"Zarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KdXK6toCKJ"},{"type":"text","value":" dataset.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U8As4Q5yC8"}],"key":"nlj2q1N917"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"**Since we saved the combined virtual dataset, this work doesn’t have to be repeated for anyone else to use this dataset. All they need is to pass the reference file storing the virtual dataset to ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TjILYJPVlP"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"qBpc8wBsQn"},{"type":"text","value":" and it is as if they had a ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"C7Vu5wZ2dn"},{"type":"inlineCode","value":"Zarr","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FV3o9fAIsD"},{"type":"text","value":" dataset!","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SGGwjYel9q"}],"key":"AmqwthEJVq"}],"key":"CfoTWtLPlC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open combined virtual dataset with Kerchunk","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T97oi0Esyi"}],"identifier":"open-combined-virtual-dataset-with-kerchunk","label":"Open combined virtual dataset with Kerchunk","html_id":"open-combined-virtual-dataset-with-kerchunk","implicit":true,"key":"w5R10zGTLu"}],"key":"w9Em6qZ1wS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# We once again need to provide information for fsspec to access the remote file\nstorage_options = dict(\n    remote_protocol=\"s3\", remote_options=dict(anon=True), skip_instance_cache=True\n)\n# We will use the \"kerchunk\" engine in `xr.open_dataset` and pass the `storage_options` to the `kerchunk` engine through `backend_kwargs`\nds = xr.open_dataset(\n    output_fname,\n    engine=\"kerchunk\",\n    backend_kwargs={\"storage_options\": storage_options},\n)\nds","key":"QFf5vG1y93"},{"type":"output","id":"WHEQzDYkbCU5q4a-OLq9i","data":[],"key":"vsRNo8wKH3"}],"key":"rIMvx6VlWt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot a slice of the dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mKDMdt3qLQ"}],"identifier":"plot-a-slice-of-the-dataset","label":"Plot a slice of the dataset","html_id":"plot-a-slice-of-the-dataset","implicit":true,"key":"mNt3ykYtPb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we are using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yON5WrLz0j"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MuqzxzbsCw"},{"type":"text","value":" to select a single time slice of the dataset and plot a map of snow cover over South East Alaska.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EbDJSQYHm9"}],"key":"tYjlPcOsUR"}],"key":"m50aAGcaw5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds.isel(Time=0).SNOW.plot()","key":"gKB67UzYBm"},{"type":"output","id":"vSPsAXnwLAg-_ZDdnELlp","data":[],"key":"iOuo3ByTxk"}],"key":"hdo2wuIqJL"}],"key":"YJTUgu2ocp"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Basics of virtual Zarr stores","url":"/notebooks/foundations/kerchunk-basics","group":"Foundations"},"next":{"title":"Parallel virtual dataset creation with VirtualiZarr, Kerchunk, and Dask","url":"/notebooks/foundations/kerchunk-dask","group":"Foundations"}}},"domain":"http://localhost:3000"}
{"version":2,"kind":"Notebook","sha256":"e06211f94405aadb11307b4a910d5914bbacc4b4ee3331e38ad0923113ee7047","slug":"notebooks.generating-references.netcdf","location":"/notebooks/generating_references/NetCDF.ipynb","dependencies":[],"frontmatter":{"title":"NetCDF","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"kerchunk-cookbook","language":"python"},"authors":[{"nameParsed":{"literal":"Norland Raphael Hagen","given":"Norland Raphael","family":"Hagen"},"name":"Norland Raphael Hagen","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/kerchunk-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/kerchunk-cookbook/blob/main/notebooks/generating_references/NetCDF.ipynb","thumbnail":"/kerchunk-cookbook/build/ARG-4649e427837039e9a183db1cd2116448.png","exports":[{"format":"ipynb","filename":"NetCDF.ipynb","url":"/kerchunk-cookbook/build/NetCDF-7dc54cef8a32bfc3a537bf9352fc7c85.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Generating virtual datasets from NetCDF files","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"G4XGTcBBAQ"}],"key":"ztLQCKcdlU"}],"key":"xRnw5oTBlv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","url":"/kerchunk-cookbook/build/ARG-4649e427837039e9a183db1cd2116448.png","alt":"ARG","width":350,"key":"hDHe7pkGig","urlSource":"../images/ARG.png"}],"key":"lRhL9WIsBw"}],"key":"qBAmKf80LG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pSnQApRRFp"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"jcTQJiLKQ9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Within this notebook, we will cover:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SEEOzzbY7m"}],"key":"PzbHxng9xY"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"How to access remote NetCDF data using ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"dWaqMVga8Q"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pqYdOireeU"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"egCiC0LYIV"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kwEIVBF9jG"}],"key":"Hs2ZY6fnOy"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Combining multiple virtual datasets","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"YaOb6VX4jm"}],"key":"e48XuEoKRs"}],"key":"FHbKMARErs"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"This notebook shares many similarities with the  ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"NR3UVaaDaA"},{"type":"link","url":"./02_kerchunk_multi_file.ipynb","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"multi-file virtual datasets with VirtualiZarr","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"TpdwO7W0xY"}],"urlSource":"./02_kerchunk_multi_file.ipynb","key":"HGaptFVKoq"},{"type":"text","value":" notebook. If you are confused on the function of a block of code, please refer there for a more detailed breakdown of what each line is doing.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ORBN8dh80b"}],"key":"UtwWhW5cip"},{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"h1kctHvTs2"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"xAGhnLIchQ"},{"type":"table","position":{"start":{"line":12,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"WdV44Mq6fq"}],"key":"uJWRvOWNsT"},{"type":"tableCell","header":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"QrmlbYcvqM"}],"key":"VdMNyRuc0z"},{"type":"tableCell","header":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"qtvjGeE5ir"}],"key":"peGqgfXktp"}],"key":"AkldJp5xpf"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"uQ1Efg56Vi"}],"urlSource":"../foundations/01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"KmxPvR4Y2G"}],"key":"bRu28QVn8L"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Jk5F5WJLhQ"}],"key":"EEy2otq0mO"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"MbQZ4qfMQc"}],"key":"avuUF7PB4X"}],"key":"H6OJKVgfXH"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-multi-file","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Multi-file virtual datasets with VirtualiZarr","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"wcQ5aQSC0H"}],"urlSource":"../foundations/02_kerchunk_multi_file.ipynb","dataUrl":"/notebooks.foundations.kerchunk-multi-file.json","internal":true,"protocol":"file","key":"lxD9AehyKG"}],"key":"jIs839q6Bp"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"y6xmXU5bD6"}],"key":"EhsvvQwqTQ"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"DaXioQyiCB"}],"key":"Nj2CHjurmt"}],"key":"DMrn2mWGPT"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-dask","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Parallel virtual dataset creation with VirtualiZarr, Kerchunk, and Dask","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"iRgFIznuV6"}],"urlSource":"../foundations/03_kerchunk_dask","dataUrl":"/notebooks.foundations.kerchunk-dask.json","internal":true,"protocol":"file","key":"ydZ3WvF0Ng"}],"key":"CHpS2Nhdom"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"u0Aoa7i3xr"}],"key":"eRAdW8Ro3y"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Zr6sDK1Ra4"}],"key":"CsKn7QxC87"}],"key":"BaIo0XQ0YU"},{"type":"tableRow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Introduction to Xarray","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ATTAGGAARr"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"yBEoOxMmxd"}],"key":"jp2Vo4EEJY"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"qEuITFQcS9"}],"key":"AnQZYdxQGC"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"IO/Visualization","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"mYyAf9jWqG"}],"key":"M7bvjYW2II"}],"key":"mTYPM0OCUD"}],"key":"pyUFNELKA2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"eDZYACqjuB"}],"key":"bmj6e3TOUe"},{"type":"text","value":": 45 minutes","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Ggivm87UGE"}],"key":"F1Ol2atWuC"}],"key":"LXXh9GXZn3"},{"type":"thematicBreak","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"JhMYv31YKK"}],"key":"AzZK3mD53f"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Motivation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uyttWkxX06"}],"identifier":"motivation","label":"Motivation","html_id":"motivation","implicit":true,"key":"pwbQpIGtZH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"NetCDF4/HDF5 is one of the most universally adopted file formats in earth sciences, with support of much of the community as well as scientific agencies, data centers and university labs. A huge amount of legacy data has been generated in this format. Fortunately, using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VXr9j9ulRX"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"erFnfIK9Jq"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NJnpRc30yT"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xAqJn9hVek"},{"type":"text","value":", we can read these datasets as if they were an Analysis-Read Cloud-Optimized (ARCO) format such as ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Bn7DAnvo7U"},{"type":"inlineCode","value":"Zarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vlHWfri9nh"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nUUd8gwDxD"}],"key":"Mb2wHXUz2a"}],"key":"R5rkK6ofFf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"About the Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eGv9BdfOAD"}],"identifier":"about-the-dataset","label":"About the Dataset","html_id":"about-the-dataset","implicit":true,"key":"zxEDvMBz20"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For this example, we will look at a weather dataset composed of multiple NetCDF files.The SMN-Arg is a WRF deterministic weather forecasting dataset created by the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kgsVhE9q0w"},{"type":"inlineCode","value":"Servicio Meteorológico Nacional de Argentina","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"otEKuCqsmp"},{"type":"text","value":" that covers Argentina as well as many neighboring countries at a 4km spatial resolution.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KqsUyyViOa"}],"key":"sRr6yGc0qF"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The model is initialized twice daily at 00 & 12 UTC with hourly forecasts for variables such as temperature, relative humidity, precipitation, wind direction and magnitude etc. for multiple atmospheric levels.\nThe data is output at hourly intervals with a maximum prediction lead time of 72 hours in NetCDF files.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"H9ddsI7iRK"}],"key":"KnyyRYPY8f"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"More details on this dataset can be found ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"iBgx7EfuKm"},{"type":"link","url":"https://registry.opendata.aws/smn-ar-wrf-dataset/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JPowZEPu3Q"}],"urlSource":"https://registry.opendata.aws/smn-ar-wrf-dataset/","key":"Az2FHlWG5C"},{"type":"text","value":".","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"vLlPIZ9jpO"}],"key":"Z4JiZuc6Hs"}],"key":"uoZ1z3R2Fw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Flags","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xvUpcEirdd"}],"identifier":"flags","label":"Flags","html_id":"flags","implicit":true,"key":"XAtkUNdL8o"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In the section below, set the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pC07YvUcZr"},{"type":"inlineCode","value":"subset","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ELdOVpz27z"},{"type":"text","value":" flag to be ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"N5TWmfgFIx"},{"type":"inlineCode","value":"True","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"s6Td7yPCdp"},{"type":"text","value":" (default) or ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Lv7QfzIExI"},{"type":"inlineCode","value":"False","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UyO6uT6k2P"},{"type":"text","value":" depending if you want this notebook to process the full file list. If set to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DoMlEoX8nB"},{"type":"inlineCode","value":"True","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LdtUzMc8FW"},{"type":"text","value":", then a subset of the file list will be processed (Recommended)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cq9yN0u3Pj"}],"key":"YD86ycZqYu"}],"key":"zEkerhGQE4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subset_flag = True","key":"xmN8jDxnoE"},{"type":"output","id":"-G1iiGsQxIOcjZ707vb-Q","data":[],"key":"ZyGIu9AxVd"}],"key":"hGgYHCRHbU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QJRhgRYOeH"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"TS7HAzwtfq"}],"key":"gP7zdSEabD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import logging\n\nimport dask\nimport fsspec\nimport s3fs\nimport xarray as xr\nfrom distributed import Client\nfrom virtualizarr import open_virtual_dataset","key":"gTbkqRXgAr"},{"type":"output","id":"AqvLTOTDYEUPmi74cPCLY","data":[],"key":"sLuM3O1tMu"}],"key":"hxqGAv0DCV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Examining a Single NetCDF File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wMLD23LZpT"}],"identifier":"examining-a-single-netcdf-file","label":"Examining a Single NetCDF File","html_id":"examining-a-single-netcdf-file","implicit":true,"key":"Q9NH1UGBG8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before we use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zUBj6BnOuS"},{"type":"inlineCode","value":"VirtualiZarr","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pbUaZ3fL3I"},{"type":"text","value":" to create virtual datasets for multiple files, we can load a single NetCDF file to examine it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pAXngH278b"}],"key":"U9NuJR9MFo"}],"key":"IoVReg1dos"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# URL pointing to a single NetCDF file\nurl = \"s3://smn-ar-wrf/DATA/WRF/DET/2022/12/31/00/WRFDETAR_01H_20221231_00_072.nc\"\n\n# Initialize a s3 filesystem\nfs = s3fs.S3FileSystem(anon=True)\n# Use Xarray to open a remote NetCDF file\nds = xr.open_dataset(fs.open(url), engine=\"h5netcdf\")","key":"QWLVcg8Rur"},{"type":"output","id":"jXfp-MliAm-XiERQ_5WXE","data":[],"key":"unx1ttTf15"}],"key":"YoZtd7C2aB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here we see the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RhPqU7SbaS"},{"type":"inlineCode","value":"repr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gL3vqOwUY7"},{"type":"text","value":" from the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vf4jiPgXaD"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ebnIqt6UpU"},{"type":"text","value":" Dataset of a single ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WAr0TyMVGp"},{"type":"inlineCode","value":"NetCDF","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XMEFaWj62q"},{"type":"text","value":" file. From examining the output, we can tell that the Dataset dimensions are ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PA4c7f0Uus"},{"type":"inlineCode","value":"['time','y','x']","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oGTAqAQ7vt"},{"type":"text","value":", with time being only a single step.\nLater, when we use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xWDtGAWyJk"},{"type":"inlineCode","value":"Xarray's","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N73JbriL6m"},{"type":"text","value":" ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eop6q6E09f"},{"type":"inlineCode","value":"combine_nested","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SvKWaBf6di"},{"type":"text","value":" functionality, we will need to know on which dimensions to concatenate across.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"actzxsJdjR"}],"key":"doXgt4MNXl"}],"key":"UIwFHczXpU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create Input File List","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CkW28IZLaA"}],"identifier":"create-input-file-list","label":"Create Input File List","html_id":"create-input-file-list","implicit":true,"key":"jCgLfIK0mW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we are using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U13LDAyenZ"},{"type":"inlineCode","value":"fsspec's","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YRSEaUBKXi"},{"type":"text","value":" glob functionality along with the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KBkQhrWOoS"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M7NkQqzMXG"}],"key":"Yh2qVFOhnJ"},{"type":"text","value":" wildcard operator and some string slicing to grab a list of NetCDF files from a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sKnyfU0og5"},{"type":"inlineCode","value":"s3","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CkZiEquv4s"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BMRwohNaWb"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m6LTU0LeJ1"},{"type":"text","value":" filesystem.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aiujY0qdVM"}],"key":"tRP8LVdTAQ"}],"key":"tQmGM3f97X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initiate fsspec filesystems for reading\nfs_read = fsspec.filesystem(\"s3\", anon=True, skip_instance_cache=True)\n\nfiles_paths = fs_read.glob(\"s3://smn-ar-wrf/DATA/WRF/DET/2022/12/31/12/*\")\n\n# Here we prepend the prefix 's3://', which points to AWS.\nfiles_paths = sorted([\"s3://\" + f for f in files_paths])\n\n\n# If the subset_flag == True (default), the list of input files will be subset\n# to speed up the processing\nif subset_flag:\n    files_paths = files_paths[0:8]","key":"H4LgBfzZwn"},{"type":"output","id":"A98wDTeu-pFPMIT5mbj_q","data":[],"key":"gP1uS0La2A"}],"key":"ffVaXN1BOF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Start a Dask Client","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NatJO701wY"}],"identifier":"start-a-dask-client","label":"Start a Dask Client","html_id":"start-a-dask-client","implicit":true,"key":"tya8ilkCNp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To parallelize the creation of our reference files, we will use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jxzuInn8TD"},{"type":"inlineCode","value":"Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ggOiyoCYRG"},{"type":"text","value":". For a detailed guide on how to use Dask and Kerchunk, see the Foundations notebook: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DVeYOkIzCc"},{"type":"link","url":"../foundations/kerchunk_dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Kerchunk and Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gijoU5wbKn"}],"urlSource":"../foundations/kerchunk_dask","key":"YWpPt5c3FI"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DAbVM6zqxa"}],"key":"BXLBhGAwdB"}],"key":"xBKF4dTtW5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client = Client(n_workers=8, silence_logs=logging.ERROR)\nclient","key":"NMcyrLb6Bj"},{"type":"output","id":"U8IOMi6Irw1DFfY-87hZx","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/distributed/node.py:187: UserWarning: Port 8787 is already in use.\nPerhaps you already have a cluster running?\nHosting the HTTP server on port 35611 instead\n  warnings.warn(\n"},{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"<Client: 'tcp://127.0.0.1:43511' processes=8 threads=8, memory=15.62 GiB>","content_type":"text/plain"},"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-0dfd1fb2-725f-11f0-9098-000d3a90fcae</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> distributed.LocalCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:35611/status\" target=\"_blank\">http://127.0.0.1:35611/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n            <button style=\"margin-bottom: 12px;\" data-commandlinker-command=\"dask:populate-and-launch-layout\" data-commandlinker-args='{\"url\": \"http://127.0.0.1:35611/status\" }'>\n                Launch dashboard in JupyterLab\n            </button>\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">a7a3ffce</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:35611/status\" target=\"_blank\">http://127.0.0.1:35611/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 8\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 8\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-c13b9bfb-627b-4cfe-aa8d-aac32bf2bae3</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:43511\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:35611/status\" target=\"_blank\">http://127.0.0.1:35611/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:36139\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:38843/status\" target=\"_blank\">http://127.0.0.1:38843/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:43327\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-96ekh3hr\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:42611\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:45593/status\" target=\"_blank\">http://127.0.0.1:45593/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:42621\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-camagvyg\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:37893\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33539/status\" target=\"_blank\">http://127.0.0.1:33539/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:42165\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-4j4u1zr5\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:43937\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:43587/status\" target=\"_blank\">http://127.0.0.1:43587/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:46247\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-w2i6swr5\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 4</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:38553\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:46165/status\" target=\"_blank\">http://127.0.0.1:46165/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:43469\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-ydm3ubhw\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 5</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:40903\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:44111/status\" target=\"_blank\">http://127.0.0.1:44111/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:45767\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-_qz_az_9\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 6</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:38661\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:44875/status\" target=\"_blank\">http://127.0.0.1:44875/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:38547\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-9etfe59h\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 7</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:46681\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:42725/status\" target=\"_blank\">http://127.0.0.1:42725/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:42991\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-eivstg8a\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"}}}],"key":"lkyad7OGkt"}],"key":"jEJcm2VgNg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def generate_virtual_dataset(file, storage_options):\n    return open_virtual_dataset(\n        file, indexes={}, reader_options={\"storage_options\": storage_options}\n    )\n\n\nstorage_options = dict(anon=True, default_fill_cache=False, default_cache_type=\"none\")\n# Generate Dask Delayed objects\ntasks = [\n    dask.delayed(generate_virtual_dataset)(file, storage_options)\n    for file in files_paths\n]","key":"HzthZy2jkX"},{"type":"output","id":"xYD96sZVW7bCA1th-qQv4","data":[],"key":"b1A0tlfyvb"}],"key":"NNV247W1Xf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Start parallel processing\nimport warnings\n\nwarnings.filterwarnings(\"ignore\")\nvirtual_datasets = list(dask.compute(*tasks))","key":"qNATWsOfHS"},{"type":"output","id":"Ni2l6oqgSLFF71z4P6PUI","data":[{"output_type":"stream","name":"stderr","text":"2025-08-06 00:48:38,415 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-bd2e52e9-59ae-427d-a64f-668844a09af5\nState:     executing\nTask:  <Task 'generate_virtual_dataset-bd2e52e9-59ae-427d-a64f-668844a09af5' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4248/2691251620.py\", line 2, in generate_virtual_dataset\\n'\n\n"},{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mTypeError\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[7]\u001b[39m\u001b[32m, line 5\u001b[39m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mwarnings\u001b[39;00m\n\u001b[32m      4\u001b[39m warnings.filterwarnings(\u001b[33m\"\u001b[39m\u001b[33mignore\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m----> \u001b[39m\u001b[32m5\u001b[39m virtual_datasets = \u001b[38;5;28mlist\u001b[39m(\u001b[43mdask\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43mtasks\u001b[49m\u001b[43m)\u001b[49m)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/dask/base.py:681\u001b[39m, in \u001b[36mcompute\u001b[39m\u001b[34m(traverse, optimize_graph, scheduler, get, *args, **kwargs)\u001b[39m\n\u001b[32m    678\u001b[39m     expr = expr.optimize()\n\u001b[32m    679\u001b[39m     keys = \u001b[38;5;28mlist\u001b[39m(flatten(expr.__dask_keys__()))\n\u001b[32m--> \u001b[39m\u001b[32m681\u001b[39m     results = \u001b[43mschedule\u001b[49m\u001b[43m(\u001b[49m\u001b[43mexpr\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mkeys\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    683\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m repack(results)\n\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[6]\u001b[39m\u001b[32m, line 2\u001b[39m, in \u001b[36mgenerate_virtual_dataset\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m      1\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mgenerate_virtual_dataset\u001b[39m(file, storage_options):\n\u001b[32m----> \u001b[39m\u001b[32m2\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m open_virtual_dataset(\n\u001b[32m      3\u001b[39m         file, indexes={}, reader_options={\u001b[33m\"\u001b[39m\u001b[33mstorage_options\u001b[39m\u001b[33m\"\u001b[39m: storage_options}\n\u001b[32m      4\u001b[39m     )\n\n\u001b[31mTypeError\u001b[39m: open_virtual_dataset() got an unexpected keyword argument 'indexes'","ename":"TypeError","evalue":"open_virtual_dataset() got an unexpected keyword argument 'indexes'"}],"key":"n4mZRNJEJ3"}],"key":"m58uLJ6I04"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combine virtual datasets and write a Kerchunk reference JSON to store the virtual Zarr store","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Zj8OiydJTi"}],"identifier":"combine-virtual-datasets-and-write-a-kerchunk-reference-json-to-store-the-virtual-zarr-store","label":"Combine virtual datasets and write a Kerchunk reference JSON to store the virtual Zarr store","html_id":"combine-virtual-datasets-and-write-a-kerchunk-reference-json-to-store-the-virtual-zarr-store","implicit":true,"key":"IlFRBFMeUB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell, we are combining all the `virtual datasets that were generated above into a single reference file and writing that file to disk.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r27cXcYFYA"}],"key":"vBiHlfUEBC"}],"key":"IYXfMi4zJy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"combined_vds = xr.combine_nested(\n    virtual_datasets, concat_dim=[\"time\"], coords=\"minimal\", compat=\"override\"\n)\ncombined_vds","key":"DzmShWNOaG"},{"type":"output","id":"llkEL0NsAUP2zgdUdzR1X","data":[],"key":"PBRxTAvFay"}],"key":"jhxrPGFWXu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"combined_vds.virtualize.to_kerchunk(\"ARG_combined.json\", format=\"json\")","key":"ZThbNPKVje"},{"type":"output","id":"GQlECemfwubtatB7FMsW3","data":[],"key":"jSKnpXJX8O"}],"key":"BxOxxqoDVs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shut down the Dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q37OJCFthS"}],"identifier":"shut-down-the-dask-cluster","label":"Shut down the Dask cluster","html_id":"shut-down-the-dask-cluster","implicit":true,"key":"DHMNsRIeJ0"}],"key":"wknGxUjgV2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.shutdown()","key":"WcWyjG0Z01"},{"type":"output","id":"VO64aMCzoRP4bpMFeR2O9","data":[],"key":"cSw8n3Lg7I"}],"key":"LxtjE9H6wb"}],"key":"vYwHjxvSLL"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Appending to Kerchunk references","url":"/notebooks/advanced/appending","group":"Advanced"},"next":{"title":"GRIB2","url":"/notebooks/generating-references/grib2","group":"Generating Reference Files"}}},"domain":"http://localhost:3000"}
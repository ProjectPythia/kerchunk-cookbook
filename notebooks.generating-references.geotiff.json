{"version":2,"kind":"Notebook","sha256":"a5a6656cad60f74d0711246cf4b64f7c40185e66f9bfb7a268d0f380bd235c17","slug":"notebooks.generating-references.geotiff","location":"/notebooks/generating_references/GeoTIFF.ipynb","dependencies":[],"frontmatter":{"title":"GeoTIFF","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"kerchunk-cookbook","language":"python"},"authors":[{"nameParsed":{"literal":"Norland Raphael Hagen","given":"Norland Raphael","family":"Hagen"},"name":"Norland Raphael Hagen","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/kerchunk-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/kerchunk-cookbook/blob/main/notebooks/generating_references/GeoTIFF.ipynb","thumbnail":"/kerchunk-cookbook/build/radar-d1df5480c16a7740fce7f8246df973cd.png","exports":[{"format":"ipynb","filename":"GeoTIFF.ipynb","url":"/kerchunk-cookbook/build/GeoTIFF-47fb63318fef2b1550962688270c4ff1.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Generating virutal datasets from GeoTiff files","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eH5LGlXfv0"}],"key":"nwbZCdPl2a"}],"key":"LeZBVT10Dm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","url":"/kerchunk-cookbook/build/radar-d1df5480c16a7740fce7f8246df973cd.png","alt":"ARG","width":400,"key":"IkL0aacAJc","urlSource":"../images/radar.png"}],"key":"LZ8T0ynyoq"}],"key":"guHVBYlAwl"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V9BBYG53FG"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"mf7XgtiXBY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this tutorial we will cover:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XEyIwZR9uG"}],"key":"ILKSt7LosK"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"How to generate virtual datasets from GeoTIFFs.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hXhux4UG90"}],"key":"jfhPSpVgwL"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Combining virtual datasets.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"R3tsg2rads"}],"key":"xpcjkLYGJR"}],"key":"LNeGMEHZd3"},{"type":"heading","depth":2,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"oSGr4ciod7"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"HpNIYPQfcP"},{"type":"table","position":{"start":{"line":10,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"NSinio3bwv"}],"key":"POO3jS5L71"},{"type":"tableCell","header":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Uz2co8QXy0"}],"key":"TSTPzbmSPK"},{"type":"tableCell","header":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Dsa9hc68Le"}],"key":"hxiWGGFZ5x"}],"key":"mSVfP9sGZH"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"wAQu6x7LVD"}],"urlSource":"../foundations/01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"SObGvKVpV2"}],"key":"YCujyQgAPf"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"g2E5zj9209"}],"key":"muQKF1a4jU"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"kuflsCFWbZ"}],"key":"ZXmiSVGeO4"}],"key":"TtdThfxN1z"},{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-multi-file","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Multi-file virtual datasets with VirtualiZarr","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"MGXcx8gi5E"}],"urlSource":"../foundations/02_kerchunk_multi_file.ipynb","dataUrl":"/notebooks.foundations.kerchunk-multi-file.json","internal":true,"protocol":"file","key":"b4Zl3b0IuF"}],"key":"G8p0eVwYln"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"UY0oMLZePu"}],"key":"d7xCcUqeLh"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"OBQIUCFP5K"}],"key":"TVpsiN2otF"}],"key":"umerwoTu5S"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-dask","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Parallel virtual dataset creation with VirtualiZarr, Kerchunk, and Dask","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"FesDBkgXRs"}],"urlSource":"../foundations/03_kerchunk_dask","dataUrl":"/notebooks.foundations.kerchunk-dask.json","internal":true,"protocol":"file","key":"Fo3y0Uw3xY"}],"key":"EEGJqkYhtE"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Rqwh9gIu1H"}],"key":"sBl94VCscj"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"fL21q9o2h3"}],"key":"GmZKuwmOKK"}],"key":"sBvDf0hC7G"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Introduction to Xarray","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"G07IHpvord"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"OzSlf7fRCM"}],"key":"wyLKedVCqs"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"aVo2l29VIq"}],"key":"ApqnCiri6x"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"IO/Visualization","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Om4BYXWyM0"}],"key":"sy1NlCLnxA"}],"key":"QOhq57PBVg"}],"key":"aDq1j61HW5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ONO6xRnArg"}],"key":"f20MzpSbCF"},{"type":"text","value":": 30 minutes","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"P5E32eVJCF"}],"key":"HaNnlzonrU"}],"key":"c8xZLb3VHx"},{"type":"thematicBreak","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"qM04W2JiaP"}],"key":"OAtc8XqV9q"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"About the Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fZDYk0P1Fg"}],"identifier":"about-the-dataset","label":"About the Dataset","html_id":"about-the-dataset","implicit":true,"key":"KtSgL32Ioy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Finish Meterological Institute (FMI) Weather Radar Dataset is a collection of GeoTIFF files containing multiple radar specific variables, such as rainfall intensity, precipitation accumulation (in 1, 12 and 24 hour increments),  radar reflectivity, radial velocity, rain classification and the cloud top height. It is available through the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lCGBHLvgGO"},{"type":"link","url":"https://aws.amazon.com/marketplace/pp/prodview-koodet467asui?sr=0-19&ref_=beagle&applicationId=AWSMPContessa","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"AWS public data portal","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dHoc6bGnST"}],"urlSource":"https://aws.amazon.com/marketplace/pp/prodview-koodet467asui?sr=0-19&ref_=beagle&applicationId=AWSMPContessa","key":"LwanPxlqd1"},{"type":"text","value":" and is updated frequently.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Di7gWuwOpv"}],"key":"DKe5sRKrBK"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"More details on this dataset can be found ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IJuOsuUNWT"},{"type":"link","url":"https://en.ilmatieteenlaitos.fi/radar-data-on-aws-s3","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"br7TOzwtXy"}],"urlSource":"https://en.ilmatieteenlaitos.fi/radar-data-on-aws-s3","key":"pI1O5K936R"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zJKDVT3By3"}],"key":"buLXhuptmk"}],"key":"JwcXgAKWNq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import logging\nfrom datetime import datetime\n\nimport dask\nimport fsspec\nimport rioxarray\nimport s3fs\nimport xarray as xr\nfrom distributed import Client\nfrom virtualizarr import open_virtual_dataset","key":"YNx8B1f2k9"},{"type":"output","id":"dyAbcy6RBQNhL7iBZUPl1","data":[],"key":"V33FIGoOL1"}],"key":"KV3QASt4MD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Examining a Single GeoTIFF File","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iNRHPr0Gxc"}],"identifier":"examining-a-single-geotiff-file","label":"Examining a Single GeoTIFF File","html_id":"examining-a-single-geotiff-file","implicit":true,"key":"Dxi7FMFA2J"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before we use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DcOUEVLY02"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CE635xyU9P"},{"type":"text","value":" to create indices for multiple files, we can load a single GeoTiff file to examine it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"y3s4hJk9br"}],"key":"K8PLD7VTDW"}],"key":"EGA4a6OcqD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# URL pointing to a single GeoTIFF file\nurl = \"s3://fmi-opendata-radar-geotiff/2023/07/01/FIN-ACRR-3067-1KM/202307010100_FIN-ACRR1H-3067-1KM.tif\"\n\n# Initialize a s3 filesystem\nfs = s3fs.S3FileSystem(anon=True)\n\nxds = rioxarray.open_rasterio(fs.open(url))","key":"xOz8u8H4E2"},{"type":"output","id":"oTtU04rh-xnafZA0yxSU5","data":[],"key":"VvT5JORZtc"}],"key":"D1JrwDox3L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xds","key":"dkIWDtEMnj"},{"type":"output","id":"XB3u7gWQ-f_Ir8ZH3eIpJ","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"<xarray.DataArray (band: 1, y: 1345, x: 850)> Size: 2MB\n[1143250 values with dtype=uint16]\nCoordinates:\n  * band         (band) int64 8B 1\n  * x            (x) float64 7kB -1.177e+05 -1.166e+05 ... 8.738e+05 8.75e+05\n  * y            (y) float64 11kB 7.907e+06 7.906e+06 ... 6.337e+06 6.336e+06\n    spatial_ref  int64 8B 0\nAttributes:\n    GDAL_METADATA:  <GDALMetadata>\\n<Item name=\"Observation time\" format=\"YYY...\n    AREA_OR_POINT:  Area\n    scale_factor:   1.0\n    add_offset:     0.0","content_type":"text/plain"},"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (band: 1, y: 1345, x: 850)&gt; Size: 2MB\n[1143250 values with dtype=uint16]\nCoordinates:\n  * band         (band) int64 8B 1\n  * x            (x) float64 7kB -1.177e+05 -1.166e+05 ... 8.738e+05 8.75e+05\n  * y            (y) float64 11kB 7.907e+06 7.906e+06 ... 6.337e+06 6.336e+06\n    spatial_ref  int64 8B 0\nAttributes:\n    GDAL_METADATA:  &lt;GDALMetadata&gt;\\n&lt;Item name=&quot;Observation time&quot; format=&quot;YYY...\n    AREA_OR_POINT:  Area\n    scale_factor:   1.0\n    add_offset:     0.0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>band</span>: 1</li><li><span class='xr-has-index'>y</span>: 1345</li><li><span class='xr-has-index'>x</span>: 850</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-31e50d0f-4cbe-4401-9838-bc5805f783b8' class='xr-array-in' type='checkbox' checked><label for='section-31e50d0f-4cbe-4401-9838-bc5805f783b8' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>...</span></div><div class='xr-array-data'><pre>[1143250 values with dtype=uint16]</pre></div></div></li><li class='xr-section-item'><input id='section-2c5f3210-0dde-41e9-a087-51f0724315de' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2c5f3210-0dde-41e9-a087-51f0724315de' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>band</span></div><div class='xr-var-dims'>(band)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1</div><input id='attrs-d338b54e-53b9-4ce2-b222-9b8eb69a6c84' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d338b54e-53b9-4ce2-b222-9b8eb69a6c84' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-27d3ff3f-efe5-4011-a547-ad4228f56e94' class='xr-var-data-in' type='checkbox'><label for='data-27d3ff3f-efe5-4011-a547-ad4228f56e94' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.177e+05 -1.166e+05 ... 8.75e+05</div><input id='attrs-553151ba-220f-46ea-8f24-94bd247ec834' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-553151ba-220f-46ea-8f24-94bd247ec834' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5a1a4d23-887d-4b5e-91fe-93c0d8beca68' class='xr-var-data-in' type='checkbox'><label for='data-5a1a4d23-887d-4b5e-91fe-93c0d8beca68' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-117746.71988 , -116577.426823, -115408.133766, ...,  872644.499264,\n        873813.792321,  874983.085378], shape=(850,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>7.907e+06 7.906e+06 ... 6.336e+06</div><input id='attrs-f54651e9-1448-4384-b6bc-080596cceeb0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f54651e9-1448-4384-b6bc-080596cceeb0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d639d650-f01b-415c-bb5e-0c08498df72c' class='xr-var-data-in' type='checkbox'><label for='data-d639d650-f01b-415c-bb5e-0c08498df72c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([7907167.102182, 7905998.232018, 7904829.361854, ..., 6338543.342424,\n       6337374.47226 , 6336205.602096], shape=(1345,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>spatial_ref</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-a6575149-69cb-4405-ae06-57c2e0149307' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a6575149-69cb-4405-ae06-57c2e0149307' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c876482e-20fa-44e2-87d0-df4797ec08ed' class='xr-var-data-in' type='checkbox'><label for='data-c876482e-20fa-44e2-87d0-df4797ec08ed' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>crs_wkt :</span></dt><dd>PROJCS[&quot;EUREF-FIN / TM35FIN(E,N)&quot;,GEOGCS[&quot;EUREF-FIN&quot;,DATUM[&quot;EUREF-FIN&quot;,SPHEROID[&quot;GRS 1980&quot;,6378137,298.257222101,AUTHORITY[&quot;EPSG&quot;,&quot;7019&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;1391&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;10690&quot;]],PROJECTION[&quot;Transverse_Mercator&quot;],PARAMETER[&quot;latitude_of_origin&quot;,0],PARAMETER[&quot;central_meridian&quot;,27],PARAMETER[&quot;scale_factor&quot;,0.9996],PARAMETER[&quot;false_easting&quot;,500000],PARAMETER[&quot;false_northing&quot;,0],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],AXIS[&quot;Easting&quot;,EAST],AXIS[&quot;Northing&quot;,NORTH],AUTHORITY[&quot;EPSG&quot;,&quot;3067&quot;]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314140356</dd><dt><span>inverse_flattening :</span></dt><dd>298.257222101</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>GRS 1980</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>EUREF-FIN</dd><dt><span>horizontal_datum_name :</span></dt><dd>EUREF-FIN</dd><dt><span>projected_crs_name :</span></dt><dd>EUREF-FIN / TM35FIN(E,N)</dd><dt><span>grid_mapping_name :</span></dt><dd>transverse_mercator</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>0.0</dd><dt><span>longitude_of_central_meridian :</span></dt><dd>27.0</dd><dt><span>false_easting :</span></dt><dd>500000.0</dd><dt><span>false_northing :</span></dt><dd>0.0</dd><dt><span>scale_factor_at_central_meridian :</span></dt><dd>0.9996</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS[&quot;EUREF-FIN / TM35FIN(E,N)&quot;,GEOGCS[&quot;EUREF-FIN&quot;,DATUM[&quot;EUREF-FIN&quot;,SPHEROID[&quot;GRS 1980&quot;,6378137,298.257222101,AUTHORITY[&quot;EPSG&quot;,&quot;7019&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;1391&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;10690&quot;]],PROJECTION[&quot;Transverse_Mercator&quot;],PARAMETER[&quot;latitude_of_origin&quot;,0],PARAMETER[&quot;central_meridian&quot;,27],PARAMETER[&quot;scale_factor&quot;,0.9996],PARAMETER[&quot;false_easting&quot;,500000],PARAMETER[&quot;false_northing&quot;,0],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],AXIS[&quot;Easting&quot;,EAST],AXIS[&quot;Northing&quot;,NORTH],AUTHORITY[&quot;EPSG&quot;,&quot;3067&quot;]]</dd><dt><span>GeoTransform :</span></dt><dd>-118331.36640835612 1169.2930568410832 0.0 7907751.537263516 0.0 -1168.8701637541064</dd></dl></div><div class='xr-var-data'><pre>array(0)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-175f9100-c541-49bc-a974-6fd3ab418b95' class='xr-section-summary-in' type='checkbox'  ><label for='section-175f9100-c541-49bc-a974-6fd3ab418b95' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>band</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-13042cc4-2004-45e4-927a-acf94420c195' class='xr-index-data-in' type='checkbox'/><label for='index-13042cc4-2004-45e4-927a-acf94420c195' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([1], dtype=&#x27;int64&#x27;, name=&#x27;band&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-ba6c307a-775e-48db-be0a-2ffe00b7fb1d' class='xr-index-data-in' type='checkbox'/><label for='index-ba6c307a-775e-48db-be0a-2ffe00b7fb1d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([-117746.71987993557, -116577.42682309449,  -115408.1337662534,\n       -114238.84070941232, -113069.54765257123, -111900.25459573015,\n       -110730.96153888907, -109561.66848204799,  -108392.3754252069,\n       -107223.08236836582,\n       ...\n         864459.4478665743,   865628.7409234153,   866798.0339802564,\n         867967.3270370975,   869136.6200939385,   870305.9131507797,\n         871475.2062076208,   872644.4992644618,   873813.7923213029,\n          874983.085378144],\n      dtype=&#x27;float64&#x27;, name=&#x27;x&#x27;, length=850))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-30594918-87a5-4bff-bf64-e28e983fa024' class='xr-index-data-in' type='checkbox'/><label for='index-30594918-87a5-4bff-bf64-e28e983fa024' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([7907167.1021816395,  7905998.232017885,  7904829.361854131,\n        7903660.491690377,  7902491.621526623,  7901322.751362869,\n        7900153.881199115,   7898985.01103536,  7897816.140871607,\n        7896647.270707852,\n       ...\n        6346725.433569907,  6345556.563406154,  6344387.693242399,\n        6343218.823078645,  6342049.952914891,  6340881.082751137,\n        6339712.212587383,  6338543.342423629,  6337374.472259874,\n         6336205.60209612],\n      dtype=&#x27;float64&#x27;, name=&#x27;y&#x27;, length=1345))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-cd89e17c-1261-4e16-96b7-24107ba763fe' class='xr-section-summary-in' type='checkbox'  checked><label for='section-cd89e17c-1261-4e16-96b7-24107ba763fe' class='xr-section-summary' >Attributes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>GDAL_METADATA :</span></dt><dd>&lt;GDALMetadata&gt;\n&lt;Item name=&quot;Observation time&quot; format=&quot;YYYYMMDDhhmm&quot;&gt;202307010100&lt;/Item&gt;\n&lt;Item name=&quot;Quantity&quot; unit=&quot;mm&quot;&gt;Precipitation accumulation&lt;/Item&gt;\n&lt;Item name=&quot;Gain&quot;&gt;0.010000&lt;/Item&gt;\n&lt;Item name=&quot;Offset&quot;&gt;0.000000&lt;/Item&gt;\n&lt;Item name=&quot;Nodata&quot;&gt;65535&lt;/Item&gt;\n&lt;Item name=&quot;Undetect&quot;&gt;0&lt;/Item&gt;\n&lt;Item name=&quot;Accumulation time&quot; unit=&quot;h&quot;&gt;1&lt;/Item&gt;\n&lt;Item name=&quot;Temporal type&quot;&gt;Past&lt;/Item&gt;\n&lt;Item name=&quot;Z=AR^B relation parameter A&quot;&gt;200.000000&lt;/Item&gt;\n&lt;Item name=&quot;Z=AR^B relation parameter B&quot;&gt;1.600000&lt;/Item&gt;\n&lt;/GDALMetadata&gt;\n</dd><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>scale_factor :</span></dt><dd>1.0</dd><dt><span>add_offset :</span></dt><dd>0.0</dd></dl></div></li></ul></div></div>","content_type":"text/html"}}}],"key":"aY7ueCzo67"}],"key":"GHILCIiMUi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"xds.isel(band=0).where(xds < 2000).plot()","key":"DtcRaNQka4"},{"type":"output","id":"1VrmipUTuEc7rArOdba-u","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"55f7d58acf5ba8feabb9d6750dbd9fe5","path":"/kerchunk-cookbook/build/55f7d58acf5ba8feabb9d6750dbd9fe5.png"}}}],"key":"PkBtUf9fUy"}],"key":"xBNeH4G0hb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create Input File List","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sMnd7AWwsi"}],"identifier":"create-input-file-list","label":"Create Input File List","html_id":"create-input-file-list","implicit":true,"key":"X49XGAkI9U"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we are using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nt0zaF8xRA"},{"type":"inlineCode","value":"fsspec's","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EqRkrc2Qp9"},{"type":"text","value":" glob functionality along with the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Scn9Vo7DzG"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BYSq548OXx"}],"key":"MXjflwjPco"},{"type":"text","value":" wildcard operator and some string slicing to grab a list of GeoTIFF files from a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lrNsihWhlt"},{"type":"inlineCode","value":"s3","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mB42oeHXH0"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"b3ApJzPhfM"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MYezMj9UV5"},{"type":"text","value":" filesystem.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RJwAFibLbv"}],"key":"GkBYAmi3wN"}],"key":"ohbCbTDOjj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initiate fsspec filesystems for reading\nfs_read = fsspec.filesystem(\"s3\", anon=True, skip_instance_cache=True)\n\nfiles_paths = fs_read.glob(\n    \"s3://fmi-opendata-radar-geotiff/2023/01/01/FIN-ACRR-3067-1KM/*24H-3067-1KM.tif\"\n)\n# Here we prepend the prefix 's3://', which points to AWS.\nfiles_paths = sorted([\"s3://\" + f for f in files_paths])","key":"sHQ7yII2Ya"},{"type":"output","id":"jgIGRiUossDeS_4TAmxi0","data":[],"key":"BTxL4NTTPX"}],"key":"I5ZSad46WV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Start a Dask Client","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zJWWq47hwU"}],"identifier":"start-a-dask-client","label":"Start a Dask Client","html_id":"start-a-dask-client","implicit":true,"key":"KflrXbIkT0"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To parallelize the creation of our reference files, we will use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H6RKzLSIw2"},{"type":"inlineCode","value":"Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CqkBbrhs7K"},{"type":"text","value":". For a detailed guide on how to use Dask and Kerchunk, see the Foundations notebook: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N9xhqp2XWf"},{"type":"link","url":"../foundations/kerchunk_dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Kerchunk and Dask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pxc6E3KWP9"}],"urlSource":"../foundations/kerchunk_dask","key":"r36AtPAF28"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"s5CLC1IanO"}],"key":"YTOOEBgCFq"}],"key":"QxMzwnB6k6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client = Client(n_workers=8, silence_logs=logging.ERROR)\nclient","key":"M8HqENAHXk"},{"type":"output","id":"i6BTpxWvTLqiDF-Jhc-Ik","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"<Client: 'tcp://127.0.0.1:44991' processes=8 threads=8, memory=15.62 GiB>","content_type":"text/plain"},"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-0b000fd8-7196-11f0-9091-6045bd6f47c0</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> distributed.LocalCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n            <button style=\"margin-bottom: 12px;\" data-commandlinker-command=\"dask:populate-and-launch-layout\" data-commandlinker-args='{\"url\": \"http://127.0.0.1:8787/status\" }'>\n                Launch dashboard in JupyterLab\n            </button>\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">bb73331d</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 8\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 8\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-085c00b9-9d58-4855-8556-93e869c50be7</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:44991\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:36655\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:40971/status\" target=\"_blank\">http://127.0.0.1:40971/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:43391\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-whe39dl0\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:34721\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:37097/status\" target=\"_blank\">http://127.0.0.1:37097/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:36021\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-b7ylzugk\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:40559\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:37561/status\" target=\"_blank\">http://127.0.0.1:37561/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:40137\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-3v3tqy8k\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:39685\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33771/status\" target=\"_blank\">http://127.0.0.1:33771/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:33475\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-gb8tzi09\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 4</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:35169\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:42101/status\" target=\"_blank\">http://127.0.0.1:42101/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:41883\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-xbnn6_1k\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 5</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:38819\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:43145/status\" target=\"_blank\">http://127.0.0.1:43145/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:40797\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-9g6nxqrj\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 6</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:34727\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:41567/status\" target=\"_blank\">http://127.0.0.1:41567/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:37329\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-h0v67rtj\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 7</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:41659\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:42575/status\" target=\"_blank\">http://127.0.0.1:42575/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:41595\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-i_l6qvak\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"}}}],"key":"Z8djF00OGm"}],"key":"XsMqlTh0KC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def generate_virtual_dataset(file):\n    storage_options = dict(\n        anon=True, default_fill_cache=False, default_cache_type=\"none\"\n    )\n    vds = open_virtual_dataset(\n        file,\n        indexes={},\n        filetype=\"tiff\",\n        reader_options={\n            \"remote_options\": {\"anon\": True},\n            \"storage_options\": storage_options,\n        },\n    )\n    # Pre-process virtual datasets to extract time step information from the filename\n    subst = file.split(\"/\")[-1].split(\".json\")[0].split(\"_\")[0]\n    time_val = datetime.strptime(subst, \"%Y%m%d%H%M\")\n    vds = vds.expand_dims(dim={\"time\": [time_val]})\n    # Only include the raw data, not the overviews\n    vds = vds[[\"0\"]]\n    return vds","key":"YYKJvtGMGT"},{"type":"output","id":"qTmAQQo5mtOYBd8RPd-ar","data":[],"key":"ibnSgMKmEr"}],"key":"Eoilmhh23z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Generate Dask Delayed objects\ntasks = [dask.delayed(generate_virtual_dataset)(file) for file in files_paths]","key":"t1Nfu7Be51"},{"type":"output","id":"cILYZUSDpfpiVqv2TCTu1","data":[],"key":"wDgbJjD6gH"}],"key":"SPLi2kzlJI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Start parallel processing\nimport warnings\n\nwarnings.filterwarnings(\"ignore\")\nvirtual_datasets = dask.compute(*tasks)","key":"dZRKG6sGAj"},{"type":"output","id":"VjL8ObwkFv83hkye3F_J3","data":[{"output_type":"stream","name":"stderr","text":"2025-08-05 00:49:37,208 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-ea81f7d7-ba83-4346-b5e0-c3ed9350e1eb\nState:     executing\nTask:  <Task 'generate_virtual_dataset-ea81f7d7-ba83-4346-b5e0-c3ed9350e1eb' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,229 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-e9892cf4-2b49-48ee-98af-c1069e7e0798\nState:     executing\nTask:  <Task 'generate_virtual_dataset-e9892cf4-2b49-48ee-98af-c1069e7e0798' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,232 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-c7012988-b5f4-48be-9f65-8e74aad91501\nState:     executing\nTask:  <Task 'generate_virtual_dataset-c7012988-b5f4-48be-9f65-8e74aad91501' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,246 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-620c6f9f-89e3-4a10-8a54-b0cfb5e14542\nState:     executing\nTask:  <Task 'generate_virtual_dataset-620c6f9f-89e3-4a10-8a54-b0cfb5e14542' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,251 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-4d05b5b9-3fa6-4dc4-9a58-e2f33ef14660\nState:     executing\nTask:  <Task 'generate_virtual_dataset-4d05b5b9-3fa6-4dc4-9a58-e2f33ef14660' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,252 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-c237bc2f-ff4c-4254-b460-8caf77312966\nState:     executing\nTask:  <Task 'generate_virtual_dataset-c237bc2f-ff4c-4254-b460-8caf77312966' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,282 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-d6287740-4b19-4104-815c-3dc9bf8aa155\nState:     executing\nTask:  <Task 'generate_virtual_dataset-d6287740-4b19-4104-815c-3dc9bf8aa155' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,296 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-79fba056-6eb8-4c3b-8f80-9effb65c553d\nState:     executing\nTask:  <Task 'generate_virtual_dataset-79fba056-6eb8-4c3b-8f80-9effb65c553d' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,297 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-3601d70a-5714-4b3b-80ad-365fdb68d612\nState:     executing\nTask:  <Task 'generate_virtual_dataset-3601d70a-5714-4b3b-80ad-365fdb68d612' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,298 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-4c6bf9ac-fa1c-4560-8562-845be19a2072\nState:     executing\nTask:  <Task 'generate_virtual_dataset-4c6bf9ac-fa1c-4560-8562-845be19a2072' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,331 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-01f41bc0-6468-4ea8-9d9c-0bdb03fa3983\nState:     executing\nTask:  <Task 'generate_virtual_dataset-01f41bc0-6468-4ea8-9d9c-0bdb03fa3983' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,348 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-15d23af8-e36a-480b-a3d8-e54d87638235\nState:     executing\nTask:  <Task 'generate_virtual_dataset-15d23af8-e36a-480b-a3d8-e54d87638235' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,348 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-2a2fa8fe-7d81-4539-bf97-5d90c8fa95c5\nState:     executing\nTask:  <Task 'generate_virtual_dataset-2a2fa8fe-7d81-4539-bf97-5d90c8fa95c5' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,372 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-dc9864b8-5b4b-4309-8926-c25e9ccd244b\nState:     executing\nTask:  <Task 'generate_virtual_dataset-dc9864b8-5b4b-4309-8926-c25e9ccd244b' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,381 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-87dee149-8c4c-4e29-be2e-9d378ad7d787\nState:     executing\nTask:  <Task 'generate_virtual_dataset-87dee149-8c4c-4e29-be2e-9d378ad7d787' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n2025-08-05 00:49:37,382 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-fce1dffe-41d4-4f48-87c9-3a2aac88affa\nState:     executing\nTask:  <Task 'generate_virtual_dataset-fce1dffe-41d4-4f48-87c9-3a2aac88affa' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4241/4131322973.py\", line 5, in generate_virtual_dataset\\n'\n\n"},{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mTypeError\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[9]\u001b[39m\u001b[32m, line 5\u001b[39m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mwarnings\u001b[39;00m\n\u001b[32m      4\u001b[39m warnings.filterwarnings(\u001b[33m\"\u001b[39m\u001b[33mignore\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m----> \u001b[39m\u001b[32m5\u001b[39m virtual_datasets = \u001b[43mdask\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43mtasks\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/dask/base.py:681\u001b[39m, in \u001b[36mcompute\u001b[39m\u001b[34m(traverse, optimize_graph, scheduler, get, *args, **kwargs)\u001b[39m\n\u001b[32m    678\u001b[39m     expr = expr.optimize()\n\u001b[32m    679\u001b[39m     keys = \u001b[38;5;28mlist\u001b[39m(flatten(expr.__dask_keys__()))\n\u001b[32m--> \u001b[39m\u001b[32m681\u001b[39m     results = \u001b[43mschedule\u001b[49m\u001b[43m(\u001b[49m\u001b[43mexpr\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mkeys\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    683\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m repack(results)\n\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[7]\u001b[39m\u001b[32m, line 5\u001b[39m, in \u001b[36mgenerate_virtual_dataset\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m      1\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mgenerate_virtual_dataset\u001b[39m(file):\n\u001b[32m      2\u001b[39m     storage_options = \u001b[38;5;28mdict\u001b[39m(\n\u001b[32m      3\u001b[39m         anon=\u001b[38;5;28;01mTrue\u001b[39;00m, default_fill_cache=\u001b[38;5;28;01mFalse\u001b[39;00m, default_cache_type=\u001b[33m\"\u001b[39m\u001b[33mnone\u001b[39m\u001b[33m\"\u001b[39m\n\u001b[32m      4\u001b[39m     )\n\u001b[32m----> \u001b[39m\u001b[32m5\u001b[39m     vds = open_virtual_dataset(\n\u001b[32m      6\u001b[39m         file,\n\u001b[32m      7\u001b[39m         indexes={},\n\u001b[32m      8\u001b[39m         filetype=\u001b[33m\"\u001b[39m\u001b[33mtiff\u001b[39m\u001b[33m\"\u001b[39m,\n\u001b[32m      9\u001b[39m         reader_options={\n\u001b[32m     10\u001b[39m             \u001b[33m\"\u001b[39m\u001b[33mremote_options\u001b[39m\u001b[33m\"\u001b[39m: {\u001b[33m\"\u001b[39m\u001b[33manon\u001b[39m\u001b[33m\"\u001b[39m: \u001b[38;5;28;01mTrue\u001b[39;00m},\n\u001b[32m     11\u001b[39m             \u001b[33m\"\u001b[39m\u001b[33mstorage_options\u001b[39m\u001b[33m\"\u001b[39m: storage_options,\n\u001b[32m     12\u001b[39m         },\n\u001b[32m     13\u001b[39m     )\n\u001b[32m     14\u001b[39m     \u001b[38;5;66;03m# Pre-process virtual datasets to extract time step information from the filename\u001b[39;00m\n\u001b[32m     15\u001b[39m     subst = file.split(\u001b[33m\"\u001b[39m\u001b[33m/\u001b[39m\u001b[33m\"\u001b[39m)[-\u001b[32m1\u001b[39m].split(\u001b[33m\"\u001b[39m\u001b[33m.json\u001b[39m\u001b[33m\"\u001b[39m)[\u001b[32m0\u001b[39m].split(\u001b[33m\"\u001b[39m\u001b[33m_\u001b[39m\u001b[33m\"\u001b[39m)[\u001b[32m0\u001b[39m]\n\n\u001b[31mTypeError\u001b[39m: open_virtual_dataset() got an unexpected keyword argument 'indexes'","ename":"TypeError","evalue":"open_virtual_dataset() got an unexpected keyword argument 'indexes'"}],"key":"nOPkAlMCen"}],"key":"LIkx2I7nng"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combine virtual datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lHgMmHrgcg"}],"identifier":"combine-virtual-datasets","label":"Combine virtual datasets","html_id":"combine-virtual-datasets","implicit":true,"key":"EZkyiIEcZQ"}],"key":"s84lnadIsC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"combined_vds = xr.concat(virtual_datasets, dim=\"time\")\ncombined_vds","key":"KR7herUrTu"},{"type":"output","id":"MgDJ9tfXMf_tEfsztbVvN","data":[],"key":"BiAsG3e6Wq"}],"key":"SkQXtZF9b9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shut down the Dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FMrw5zx7yw"}],"identifier":"shut-down-the-dask-cluster","label":"Shut down the Dask cluster","html_id":"shut-down-the-dask-cluster","implicit":true,"key":"gXaWvKuCdt"}],"key":"WrYCTD3Bg8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.shutdown()","key":"FVRuPwE0io"},{"type":"output","id":"JrVmw6AUzC6jejEa0MSMH","data":[],"key":"qUa3Kx0jCG"}],"key":"ooMr9O3cyY"}],"key":"dLc1fxHyYd"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"GRIB2","url":"/notebooks/generating-references/grib2","group":"Generating Reference Files"},"next":{"title":"Load Kerchunked dataset with Xarray","url":"/notebooks/using-references/xarray","group":"Using Pre-Generated References"}}},"domain":"http://localhost:3000"}
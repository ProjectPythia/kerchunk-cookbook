{"version":2,"kind":"Notebook","sha256":"ff787c20d68345d7ccadb63990b5203aec321df6bca402604afcbfe6f60ec7ac","slug":"notebooks.advanced.parquet-reference-storage","location":"/notebooks/advanced/Parquet_Reference_Storage.ipynb","dependencies":[],"frontmatter":{"title":"Store virtual datasets as Kerchunk Parquet references","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"kerchunk-cookbook","language":"python"},"authors":[{"nameParsed":{"literal":"Norland Raphael Hagen","given":"Norland Raphael","family":"Hagen"},"name":"Norland Raphael Hagen","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/kerchunk-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/kerchunk-cookbook/blob/main/notebooks/advanced/Parquet_Reference_Storage.ipynb","thumbnail":"/kerchunk-cookbook/build/95b6b03e3a18dfba219c0d718515c49f.svg","exports":[{"format":"ipynb","filename":"Parquet_Reference_Storage.ipynb","url":"/kerchunk-cookbook/build/Parquet_Reference_St-a77275f7933b0914b24df7484f5ba03a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"image","url":"/kerchunk-cookbook/build/95b6b03e3a18dfba219c0d718515c49f.svg","alt":"Parquet Logo","width":400,"key":"ZXs0BDpgZj","urlSource":"https://upload.wikimedia.org/wikipedia/commons/4/47/Apache_Parquet_logo.svg"}],"key":"lJNiLB1Wt6"}],"key":"hVYt7MeGFW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Store virtual datasets as Kerchunk Parquet references","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HGUvlQ7R1s"}],"identifier":"store-virtual-datasets-as-kerchunk-parquet-references","label":"Store virtual datasets as Kerchunk Parquet references","html_id":"store-virtual-datasets-as-kerchunk-parquet-references","implicit":true,"key":"DjLZ16lrho"}],"key":"M5ZYvIzNJU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L1hNQVT2Gf"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"LCvOud34XP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this notebook we will cover how to store virtual datasets as Kerchunk Parquet references instead of Kerchunk JSON references. For large virtual datasets, using Parquet should have performance implications as the overall reference file size should be smaller and the memory overhead of combining the reference files should be lower.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gpLWOEgTSJ"}],"key":"VjbwYfqRxZ"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This notebook builds upon the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jgFTQbaaEt"},{"type":"link","url":"notebooks/foundations/01_kerchunk_basics.ipynb","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Kerchunk Basics","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FmIZ6JxAGY"}],"urlSource":"notebooks/foundations/01_kerchunk_basics.ipynb","key":"C0CFlNnOFk"},{"type":"text","value":", ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"c0gSoUyGt1"},{"type":"link","url":"notebooks/foundations/02_kerchunk_multi_file.ipynb","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Multi-File Datasets with Kerchunk","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"e95uvnswK6"}],"urlSource":"notebooks/foundations/02_kerchunk_multi_file.ipynb","key":"qdXiPcmvgc"},{"type":"text","value":" and the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Wq6JdlMMxD"},{"type":"link","url":"notebooks/foundations/03_kerchunk_dask.ipynb","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Kerchunk and Dask","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"alOAqVfWH6"}],"urlSource":"notebooks/foundations/03_kerchunk_dask.ipynb","key":"M68W2LsjRG"},{"type":"text","value":" notebooks.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"gxBDp2Fqm6"}],"key":"dD1aT5fkKB"},{"type":"heading","depth":2,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Y4hGi4YPqh"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"AFdJVMVlUu"},{"type":"table","position":{"start":{"line":9,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"o62q7GHPrS"}],"key":"N2lm2niOVl"},{"type":"tableCell","header":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lcKsnQ0ZRK"}],"key":"KIrNQsCie5"},{"type":"tableCell","header":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qOQSHVzLYj"}],"key":"SbHGG9zRtW"}],"key":"PuIkn0fQ5L"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-basics","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Basics of virtual Zarr stores","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"NCTGoH5p4B"}],"urlSource":"../foundations/01_kerchunk_basics.ipynb","dataUrl":"/notebooks.foundations.kerchunk-basics.json","internal":true,"protocol":"file","key":"cKRDKU3NQP"}],"key":"ZCiNAlbnVT"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Vb8xZ054zx"}],"key":"oKUtOhmorT"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"fjR2siPFow"}],"key":"WaSGOGWSlX"}],"key":"TKQ3f0Y2ST"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-multi-file","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Multi-file virtual datasets with VirtualiZarr","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"pLGIfFK0Tf"}],"urlSource":"../foundations/02_kerchunk_multi_file.ipynb","dataUrl":"/notebooks.foundations.kerchunk-multi-file.json","internal":true,"protocol":"file","key":"H4MlQ64b5g"}],"key":"NtzJ0ZGic1"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"LgGa0if9OJ"}],"key":"PBTOAREcOU"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"H6CbgnNKNv"}],"key":"UtCLXu4KYk"}],"key":"wALvBGk3ju"},{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"/notebooks/foundations/kerchunk-dask","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Parallel virtual dataset creation with VirtualiZarr, Kerchunk, and Dask","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"JIubFfjGxZ"}],"urlSource":"../foundations/03_kerchunk_dask","dataUrl":"/notebooks.foundations.kerchunk-dask.json","internal":true,"protocol":"file","key":"oVoY4qGIpV"}],"key":"pBbmDa3LtD"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Sw7dCPm1qD"}],"key":"hpftzTCUOE"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"V056VwpoEX"}],"key":"L0NArhVM5q"}],"key":"FgTEwLd56a"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Introduction to Xarray","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Ejoadr0Tv6"}],"urlSource":"https://foundations.projectpythia.org/core/xarray/xarray-intro.html","key":"vB9aKAZaOp"}],"key":"ADVSJZYoBm"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"LkYUdRbeka"}],"key":"W5t9lZYjzu"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"IO/Visualization","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"jFW20Oa34S"}],"key":"KR3vTUdswc"}],"key":"FXxsigMOCw"}],"key":"VlKRrYKsz6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FSwaicnikv"}],"key":"gv2VUQlkNL"},{"type":"text","value":": 30 minutes","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"h5e6dWAteZ"}],"key":"TpQh4rp1Di"}],"key":"ULKklgJ5IL"},{"type":"thematicBreak","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"vQyzEe5HLM"}],"key":"iebQoUNdfK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vug2rTwSWJ"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"lSzzT0rvkO"}],"key":"d2VHDsNMjw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import logging\n\nimport dask\nimport fsspec\nimport xarray as xr\nfrom distributed import Client\nfrom virtualizarr import open_virtual_dataset","key":"jFai4dUA4h"},{"type":"output","id":"5LndgAMPNDEvSA8rPOJZs","data":[],"key":"nyKDZDORwM"}],"key":"E2AsSGSUPn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setting up the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r35sylel2s"},{"type":"inlineCode","value":"Dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UJJyYHbwN6"},{"type":"text","value":" Client","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZOLUhqiNOd"}],"identifier":"setting-up-the-dask-client","label":"Setting up the Dask Client","html_id":"setting-up-the-dask-client","implicit":true,"key":"A2sZJMpvYY"}],"key":"YoJEHqqBPV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client = Client(n_workers=8, silence_logs=logging.ERROR)\nclient","key":"jJgt1ZhnLF"},{"type":"output","id":"7iTwelLz7Ve9tFXu5CWan","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/distributed/node.py:187: UserWarning: Port 8787 is already in use.\nPerhaps you already have a cluster running?\nHosting the HTTP server on port 35719 instead\n  warnings.warn(\n"},{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"<Client: 'tcp://127.0.0.1:46613' processes=8 threads=8, memory=15.62 GiB>","content_type":"text/plain"},"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-f10fccaf-6f39-11f0-9089-7ced8d7128e6</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> distributed.LocalCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:35719/status\" target=\"_blank\">http://127.0.0.1:35719/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n            <button style=\"margin-bottom: 12px;\" data-commandlinker-command=\"dask:populate-and-launch-layout\" data-commandlinker-args='{\"url\": \"http://127.0.0.1:35719/status\" }'>\n                Launch dashboard in JupyterLab\n            </button>\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">d56a26bd</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:35719/status\" target=\"_blank\">http://127.0.0.1:35719/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 8\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 8\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-dd24b3cf-ee69-4fa3-aa71-0f52fbbabcc0</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:46613\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:35719/status\" target=\"_blank\">http://127.0.0.1:35719/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:38403\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:38745/status\" target=\"_blank\">http://127.0.0.1:38745/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:33317\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-1_5tvipr\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:33679\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:40463/status\" target=\"_blank\">http://127.0.0.1:40463/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:46877\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-d8ll52xi\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:34155\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:39951/status\" target=\"_blank\">http://127.0.0.1:39951/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:45089\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-ube5blf4\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:33569\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:43803/status\" target=\"_blank\">http://127.0.0.1:43803/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:39775\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-fdqvpilc\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 4</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:34299\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:39427/status\" target=\"_blank\">http://127.0.0.1:39427/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:43701\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-yhhi46du\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 5</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:37743\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:43357/status\" target=\"_blank\">http://127.0.0.1:43357/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:34873\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-37j125tr\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 6</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:38301\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:38563/status\" target=\"_blank\">http://127.0.0.1:38563/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:37139\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-0giz33az\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 7</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:45571\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:42989/status\" target=\"_blank\">http://127.0.0.1:42989/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 1.95 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:40171\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-7knz1s01\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"}}}],"key":"wemkYIyAeZ"}],"key":"LiyBeVJKss"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create Input File List","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uky6UrNBDA"}],"identifier":"create-input-file-list","label":"Create Input File List","html_id":"create-input-file-list","implicit":true,"key":"dYir3z0V4t"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we are using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UNzvG3zGQK"},{"type":"inlineCode","value":"fsspec's","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ysTlvHUPpl"},{"type":"text","value":" glob functionality along with the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lzLIjrpmSB"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SJiIK6xEl9"}],"key":"UcOObEXGxV"},{"type":"text","value":" wildcard operator and some string slicing to grab a list of NetCDF files from a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e9kPmqJBkk"},{"type":"inlineCode","value":"s3","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Zt9lYv04i0"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BzBH3zEZ7z"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"G4ccbImOg3"},{"type":"text","value":" filesystem.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AHOIP0Tz4S"}],"key":"nVLvsEM6v0"}],"key":"FcTwsyJBeS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initiate fsspec filesystems for reading\nfs_read = fsspec.filesystem(\"s3\", anon=True, skip_instance_cache=True)\n\nfiles_paths = fs_read.glob(\"s3://smn-ar-wrf/DATA/WRF/DET/2022/12/31/12/*\")\n\n# Here we prepend the prefix 's3://', which points to AWS.\nfiles_paths = sorted([\"s3://\" + f for f in files_paths])","key":"WxhipucpSQ"},{"type":"output","id":"NzUkg_c6IrLkPUW1mTigO","data":[],"key":"cydDeLfbDt"}],"key":"l45k1gzteI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Subset the Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xJ6KCNmGL3"}],"identifier":"subset-the-data","label":"Subset the Data","html_id":"subset-the-data","implicit":true,"key":"BniTUezVyX"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To speed up our example, lets take a subset of the year of data.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"x2rQy6R6a5"}],"key":"qRYBsabxBa"}],"key":"K9HmwpGXCW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# If the subset_flag == True (default), the list of input files will\n# be subset to speed up the processing\nsubset_flag = True\nif subset_flag:\n    files_paths = files_paths[0:4]","key":"Gs3JE8C88I"},{"type":"output","id":"XO7r6Gx_7fgTiRFXVxP3S","data":[],"key":"VfDEaaHtnB"}],"key":"SwFW4KgCJ1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generate Lazy References","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ROxCHzMqtk"}],"identifier":"generate-lazy-references","label":"Generate Lazy References","html_id":"generate-lazy-references","implicit":true,"key":"DP8yL64Cd4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we create a function to generate a list of Dask delayed objects.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ayr08U4WDB"}],"key":"PXfCPmnBW9"}],"key":"J0H3pLyxNo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def generate_virtual_dataset(file, storage_options):\n    return open_virtual_dataset(\n        file, indexes={}, reader_options={\"storage_options\": storage_options}\n    )\n\n\nstorage_options = dict(anon=True, default_fill_cache=False, default_cache_type=\"first\")\n# Generate Dask Delayed objects\ntasks = [\n    dask.delayed(generate_virtual_dataset)(file, storage_options)\n    for file in files_paths\n]","key":"Uq1MFDOluS"},{"type":"output","id":"f2jfFo44Ks48-88iyzOJl","data":[],"key":"j8hSDN1zrX"}],"key":"iemin4ukSj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Start the Dask Processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xz2ZzTHkCO"}],"identifier":"start-the-dask-processing","label":"Start the Dask Processing","html_id":"start-the-dask-processing","implicit":true,"key":"G5ybOvi2zp"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To view the processing you can view it in real-time on the Dask Dashboard. ex: ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"msyDCQwUQF"},{"type":"link","url":"http://127.0.0.1:8787/status","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"http://​127​.0​.0​.1:8787​/status","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YuZRhXr2lb"}],"urlSource":"http://127.0.0.1:8787/status","key":"Fg0VoBnuo2"}],"key":"kID29YGalB"}],"key":"kG5ligUMGH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"virtual_datasets = list(dask.compute(*tasks))","key":"DZvox4hcgQ"},{"type":"output","id":"qXxiqVJe22TT73K6CKp8i","data":[{"output_type":"stream","name":"stderr","text":"2025-08-02 00:45:22,808 - distributed.worker - ERROR - Compute Failed\nKey:       generate_virtual_dataset-c3da7343-b443-4fee-9cef-9ba6d4ccb3fe\nState:     executing\nTask:  <Task 'generate_virtual_dataset-c3da7343-b443-4fee-9cef-9ba6d4ccb3fe' generate_virtual_dataset(...)>\nException: 'TypeError(\"open_virtual_dataset() got an unexpected keyword argument \\'indexes\\'\")'\nTraceback: '  File \"/tmp/ipykernel_4233/841847916.py\", line 2, in generate_virtual_dataset\\n'\n\n"},{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mTypeError\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[6]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m virtual_datasets = \u001b[38;5;28mlist\u001b[39m(\u001b[43mdask\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43mtasks\u001b[49m\u001b[43m)\u001b[49m)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/kerchunk-cookbook/lib/python3.13/site-packages/dask/base.py:681\u001b[39m, in \u001b[36mcompute\u001b[39m\u001b[34m(traverse, optimize_graph, scheduler, get, *args, **kwargs)\u001b[39m\n\u001b[32m    678\u001b[39m     expr = expr.optimize()\n\u001b[32m    679\u001b[39m     keys = \u001b[38;5;28mlist\u001b[39m(flatten(expr.__dask_keys__()))\n\u001b[32m--> \u001b[39m\u001b[32m681\u001b[39m     results = \u001b[43mschedule\u001b[49m\u001b[43m(\u001b[49m\u001b[43mexpr\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mkeys\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    683\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m repack(results)\n\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[5]\u001b[39m\u001b[32m, line 2\u001b[39m, in \u001b[36mgenerate_virtual_dataset\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m      1\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mgenerate_virtual_dataset\u001b[39m(file, storage_options):\n\u001b[32m----> \u001b[39m\u001b[32m2\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m open_virtual_dataset(\n\u001b[32m      3\u001b[39m         file, indexes={}, reader_options={\u001b[33m\"\u001b[39m\u001b[33mstorage_options\u001b[39m\u001b[33m\"\u001b[39m: storage_options}\n\u001b[32m      4\u001b[39m     )\n\n\u001b[31mTypeError\u001b[39m: open_virtual_dataset() got an unexpected keyword argument 'indexes'","ename":"TypeError","evalue":"open_virtual_dataset() got an unexpected keyword argument 'indexes'"}],"key":"ugf5aoabih"}],"key":"kKgYqISGzf"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combine virtual datasets using VirtualiZarr","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n5kvIV23dQ"}],"identifier":"combine-virtual-datasets-using-virtualizarr","label":"Combine virtual datasets using VirtualiZarr","html_id":"combine-virtual-datasets-using-virtualizarr","implicit":true,"key":"cE9YThRtmi"}],"key":"RpQQ7sgK9w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"combined_vds = xr.combine_nested(\n    virtual_datasets, concat_dim=[\"time\"], coords=\"minimal\", compat=\"override\"\n)\ncombined_vds","key":"M0H7dLBgeY"},{"type":"output","id":"1jtiCUmFgZ0xUa6xObcZL","data":[],"key":"Ts60XOzWQv"}],"key":"u3bra1RdXB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Write the virtual dataset to a Kerchunk Parquet reference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fXHohfUsVp"}],"identifier":"write-the-virtual-dataset-to-a-kerchunk-parquet-reference","label":"Write the virtual dataset to a Kerchunk Parquet reference","html_id":"write-the-virtual-dataset-to-a-kerchunk-parquet-reference","implicit":true,"key":"as9w2Gd7Ch"}],"key":"sVSo2zmvJv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"combined_vds.virtualize.to_kerchunk(\"combined.parq\", format=\"parquet\")","key":"zqSSm2KrE6"},{"type":"output","id":"zuqtv8zTGstyyywukJNbS","data":[],"key":"tSraeDzP8B"}],"key":"NDRtcODLon"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shutdown the Dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZXRwtbuFIK"}],"identifier":"shutdown-the-dask-cluster","label":"Shutdown the Dask cluster","html_id":"shutdown-the-dask-cluster","implicit":true,"key":"gaw68eTFXy"}],"key":"ew1s22tyDh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.shutdown()","key":"wwTRql1VDY"},{"type":"output","id":"ZCuks1IY2RfJKpsffckUg","data":[],"key":"wobu8shkF5"}],"key":"QYvfs8M3WX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load kerchunked dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"czrY75VJm8"}],"identifier":"load-kerchunked-dataset","label":"Load kerchunked dataset","html_id":"load-kerchunked-dataset","implicit":true,"key":"vEyxNENQOw"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Next we initiate a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qLqEuwM82j"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X6hecQFfv2"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QWJB6Ox90U"},{"type":"inlineCode","value":"ReferenceFileSystem","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"y2zj1HWvWm"},{"type":"text","value":".\nWe need to pass:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SU4v08dyvc"}],"key":"NQuNbLS4Qz"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The name of the parquet store","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bVNAjpeLAo"}],"key":"f9Ff2McvSb"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The remote protocol (This is the protocol of the input file urls)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tHyEr1VmaM"}],"key":"L3cNovos03"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The target protocol (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Q3vlOpQ5Wd"},{"type":"inlineCode","value":"file","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ojB8hG6ZcE"},{"type":"text","value":" since we saved our parquet store locally).","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Nfn20Ip8Gc"}],"key":"UWdICl81NM"}],"key":"LpFwjGoRXI"}],"key":"ju8ink4seA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"storage_options = {\n    \"remote_protocol\": \"s3\",\n    \"skip_instance_cache\": True,\n    \"remote_options\": {\"anon\": True},\n    \"target_protocol\": \"file\",\n    \"lazy\": True,\n}  # options passed to fsspec\nopen_dataset_options = {\"chunks\": {}}  # opens passed to xarray\n\nds = xr.open_dataset(\n    \"combined.parq\",\n    engine=\"kerchunk\",\n    storage_options=storage_options,\n    open_dataset_options=open_dataset_options,\n)\nds","key":"zi3P7pzPKi"},{"type":"output","id":"fV3CwQ3u4S8TzYFQMFfpr","data":[],"key":"dSWzWLZZSF"}],"key":"iiqPdXuZ1G"}],"key":"pk2uyR2lDu"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Parallel virtual dataset creation with VirtualiZarr, Kerchunk, and Dask","url":"/notebooks/foundations/kerchunk-dask","group":"Foundations"},"next":{"title":"Appending to Kerchunk references","url":"/notebooks/advanced/appending","group":"Advanced"}}},"domain":"http://localhost:3000"}
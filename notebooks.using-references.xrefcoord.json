{"version":2,"kind":"Notebook","sha256":"6c1f083a46fb4ffe39a90ee4f5fa9892c015ae32cab6021f22fdefcf988e187b","slug":"notebooks.using-references.xrefcoord","location":"/notebooks/using_references/Xrefcoord.ipynb","dependencies":[],"frontmatter":{"title":"Use xrefcoord to Generate Coordinates","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Norland Raphael Hagen","given":"Norland Raphael","family":"Hagen"},"name":"Norland Raphael Hagen","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/kerchunk-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/kerchunk-cookbook/blob/main/notebooks/using_references/Xrefcoord.ipynb","exports":[{"format":"ipynb","filename":"Xrefcoord.ipynb","url":"/kerchunk-cookbook/build/Xrefcoord-9a9c8147a257b2bf5255d599083f0f2c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JFwwBq712u"},{"type":"inlineCode","value":"xrefcoord","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uEw12C3NA9"},{"type":"text","value":" to Generate Coordinates","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MQWqAxnRHi"}],"identifier":"use-xrefcoord-to-generate-coordinates","label":"Use xrefcoord to Generate Coordinates","html_id":"use-xrefcoord-to-generate-coordinates","implicit":true,"key":"odJD5evGK9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"P9IPUR90gB"},{"type":"inlineCode","value":"Kerchunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lUj1uGAQ2g"},{"type":"text","value":" to generate reference datasets for GeoTIFFâ€™s, only the dimensions are preserved. ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wBU1vMSdCQ"},{"type":"inlineCode","value":"xrefcoord","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jTkNhyh5TV"},{"type":"text","value":" is a small utility that allows us to generate coordinates for these reference datasets using the geospatial metadata. Similar to other accessor add-on libraries for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RTj0Qr0vfP"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f1sF6Siyps"},{"type":"text","value":" such as ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EMfgVkuwFX"},{"type":"inlineCode","value":"rioxarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"F3HtOYLvyQ"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t8erxqX7Bt"},{"type":"inlineCode","value":"xwrf","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Wsgno3Ec0T"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jpaTUA4KFt"},{"type":"inlineCode","value":"xrefcord","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mwxsKEbCJy"},{"type":"text","value":" provides an accessor for an ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RaTzW6f4kA"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FUjRxS6Z7y"},{"type":"text","value":" dataset. Importing ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ti3A75lDu4"},{"type":"inlineCode","value":"xrefcoord","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OGjpxyGfEH"},{"type":"text","value":" allows us to use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hMal2e3FYZ"},{"type":"inlineCode","value":".xref","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Xbujvs1rV1"},{"type":"text","value":" accessor to access additional methods.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"F9x2jMpiZT"}],"key":"SvrSaZFuon"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In this tutorial we will use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xYGh99KFlo"},{"type":"inlineCode","value":"generate_coords","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LbcGNJzQao"},{"type":"text","value":" method to build coordinates for the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vc2HbOHz9V"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lM379xPT9J"},{"type":"text","value":" dataset. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"H4HoFyiIFU"},{"type":"inlineCode","value":"xrefcoord","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WdoJxOSgXQ"},{"type":"text","value":" is ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WUcIwhKkyU"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"very experimental","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"L02kobSavm"}],"key":"f0VjDgR1Ou"},{"type":"text","value":" and makes assumptions about the underlying data, such as each variable shares the same dimensions etc. Use with caution!","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"F2MpYQE0xf"}],"key":"jStJ5GF6Yc"}],"key":"SCmmxtPW9M"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AOOAiwIqoV"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"Jq5RELoZjR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Within this notebook, we will cover:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r3vOGKbMsN"}],"key":"lcjdCeoz3Y"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"How to load a Kerchunk reference dataset created from a collection of GeoTIFFs","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"X1XTmBw4r5"}],"key":"fiFhdsGrvy"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"How to use ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TTNOgXH9Gu"},{"type":"inlineCode","value":"xrefcoord","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RUKsSA7U0U"},{"type":"text","value":" to generate coordinates from a GeoTIFF reference dataset","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"iOZg5yoAXI"}],"key":"s469dGIE0u"}],"key":"NH854tSsN1"},{"type":"heading","depth":1,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"j5PwcDj7X8"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"LfRCJaLlxE"},{"type":"table","position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"OGiJgQY0ds"}],"key":"fK8uWpzNez"},{"type":"tableCell","header":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Cz7XyEHYje"}],"key":"MNa6dVHnI4"},{"type":"tableCell","header":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Ulqto9Fu3z"}],"key":"V882RjMo1M"}],"key":"nj47RZgnjI"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"link","url":"../foundations/kerchunk_basics","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Kerchunk Basics","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"nHvn2hZiU4"}],"urlSource":"../foundations/kerchunk_basics","key":"OwYMUP48VY"}],"key":"Wf0rlRobCj"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ApSrUvQSDh"}],"key":"JNDZKEbc8p"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"fRrzPJNv4a"}],"key":"ztkzgHgVEe"}],"key":"beQ6kEqiBW"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"link","url":"https://tutorial.xarray.dev/intro.html","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Xarray Tutorial","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"DY2IP241nY"}],"urlSource":"https://tutorial.xarray.dev/intro.html","key":"OXdoA5QRBu"}],"key":"zr82hFkZKz"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Required","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"M24Kk44jia"}],"key":"PdcIPeQAsm"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Core","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VPIOwzk98B"}],"key":"lHubeD1JNf"}],"key":"XK0XUdEprT"}],"key":"FqpCJ5357f"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"TUKERgzTkK"}],"key":"rRbGZG4L8z"},{"type":"text","value":": 45 minutes","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"zp52oy2CRT"}],"key":"u8Z6Qapjrz"}],"key":"h2S2FHlyRA"},{"type":"thematicBreak","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BFy6rljY6O"}],"key":"rdWDTwhITd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport xrefcoord  # noqa\n\nstorage_options = {\n    \"remote_protocol\": \"s3\",\n    \"skip_instance_cache\": True,\n    \"remote_options\": {\"anon\": True}\n}  # options passed to fsspec\nopen_dataset_options = {\"chunks\": {}}  # opens passed to xarray\n\nds = xr.open_dataset(\n    \"references/RADAR.json\",\n    engine=\"kerchunk\",\n    storage_options=storage_options,\n    open_dataset_options=open_dataset_options,\n)","key":"rPYAPUshWg"},{"type":"output","id":"Z_87K3Gpx8iMZYaFgek_V","data":[],"key":"iJvHQLTwyJ"}],"key":"KpCK74vGfM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Generate coordinates from reference dataset\nref_ds = ds.xref.generate_coords(time_dim_name=\"time\", x_dim_name=\"X\", y_dim_name=\"Y\")\n# Rename to rain accumulation in 24 hour period\nref_ds = ref_ds.rename({\"0\": \"rr24h\"})","key":"SHIg8cIjHq"},{"type":"output","id":"U-IkXkEZx6LODgOE3UTJ4","data":[],"key":"o7Ggv0kBdv"}],"key":"wQgTnbsssL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a Map","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jOzt41fx5f"}],"identifier":"create-a-map","label":"Create a Map","html_id":"create-a-map","implicit":true,"key":"CxPJxuNacL"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we are using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FoYiCU2Okm"},{"type":"inlineCode","value":"Xarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"edEdXdl4l4"},{"type":"text","value":" to select a single time slice and create a map of 24 hour accumulated rainfall.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TlaO9N9OPf"}],"key":"uCjlJJJFqk"}],"key":"vfKMWqKZjp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ref_ds[\"rr24h\"].where(ref_ds.rr24h < 60000).isel(time=0).plot(robust=True)","key":"GIonD8zCpq"},{"type":"output","id":"QsYoUgRYU7OBI2e7xyIhZ","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e3be5f326509fc1e475d7f00dd9946ca","path":"/kerchunk-cookbook/build/e3be5f326509fc1e475d7f00dd9946ca.png"}}}],"key":"gKi1mYj10F"}],"key":"NplxTlTd3d"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a Time-Series","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GgN5qXizu9"}],"identifier":"create-a-time-series","label":"Create a Time-Series","html_id":"create-a-time-series","implicit":true,"key":"HtwrY7OyDl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Next we are plotting accumulated rain as a function of time for a specific point.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hvoj70EjWL"}],"key":"k2QtESctrw"}],"key":"ZlDV3MJyXx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ref_ds[\"rr24h\"][:, 700, 700].plot()","key":"OPgDBkSmrD"},{"type":"output","id":"Tb5uPAa_tDddWtjJEaRsk","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1fa53c6a5f545054ba36b50fb8e54392","path":"/kerchunk-cookbook/build/1fa53c6a5f545054ba36b50fb8e54392.png"}}}],"key":"nV8sAc4nCD"}],"key":"GLVKa1FUvS"}],"key":"pWlHxdxwWE"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Load Kerchunked dataset with Xarray","url":"/notebooks/using-references/xarray","group":"Using Pre-Generated References"},"next":{"title":"Kerchunk and Xarray-Datatree","url":"/notebooks/using-references/datatree","group":"Using Pre-Generated References"}}},"domain":"http://localhost:3000"}